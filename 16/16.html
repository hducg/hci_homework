<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¤šåª’ä½“æ—¥è®°</title>
  <style>
      * {
          box-sizing: border-box;
          /*è¾¹æ¡†ç›’æ¨¡å‹*/
          /*â€˜*â€™ï¼šé€šé…ç¬¦é€‰æ‹©å™¨ï¼ŒåŒ¹é…é¡µé¢ä¸­çš„æ‰€æœ‰å…ƒç´  box-sizing: border-box - è®¾ç½®ç›’æ¨¡å‹ä¸ºè¾¹æ¡†ç›’æ¨¡å‹ï¼ˆborder-boxï¼šwidth/height = å†…å®¹ + å†…è¾¹è· + è¾¹æ¡† çš„æ€»å’Œï¼‰*/
      }

      body {
          font-family: 'Arial', sans-serif;     /*å¦‚æœç”¨æˆ·ç”µè„‘æ²¡æœ‰ Arialï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„æ— è¡¬çº¿å­—ä½“*/
          padding: 20px;
          background-color: #f7f9fc;
          max-width: 800px;
          margin: 0 auto;                       /* ä¸Šä¸‹è¾¹è·ä¸º0ï¼Œå·¦å³è‡ªåŠ¨ */
          line-height: 1.6;
      }

    h1 {
          text-align: center;
          color: #2c3e50;
          margin-bottom: 30px;
          padding-bottom: 15px;
          border-bottom: 2px solid #eaeaea;         /*æ·»åŠ ä¸‹åˆ†å‰²çº¿*/
    }

      .form-group {
          margin-bottom: 20px;
          background: lightblue;                  /*æ›´æ”¹äº†èƒŒæ™¯é¢œè‰²*/
          padding: 15px;
          border-radius: 8px;                     /*è¾¹æ¡†åœ†è§’*/ 
          box-shadow: 0 2px 5px rgba(0,0,0,0.05); /*æ·»åŠ æ°´å¹³åç§»0ï¼Œå‚ç›´åç§»2ï¼Œæ¨¡ç³ŠåŠå¾„5ï¼Œé»‘è‰²5%é€æ˜åº¦çš„ç›’å­é˜´å½±*/
      }

    label {
      font-weight: bold;
      display: block;                            /*å°†å…ƒç´ è®¾ç½®ä¸ºå—çŠ¶å…ƒç´ ï¼Œç‹¬å ä¸€è¡Œï¼Œå¯è®¾ç½®å®½é«˜ã€ä¸Šä¸‹å¤–è¾¹è·ï¼Œé»˜è®¤å®½åº¦ç™¾åˆ†ç™¾*/
      margin-bottom: 8px;
      color: #34495e;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    #diary-content {
      min-height: 200px;
      border: 1px solid #ccc;
      padding: 15px;
      background-color: white;
      border-radius: 4px;
    }
     
/*    placeholder å±æ€§åœ¨æ™®é€šçš„ <div> å…ƒç´ ä¸Šä¸èµ·ä½œç”¨ï¼*/
    #diary-content:empty::before {
      content: "å¼€å§‹è®°å½•ä»Šå¤©çš„æ•…äº‹...";
      color: #999;
      font-style: italic;
      font-size:14px;
    }

    #diary-content:focus::before {
      content: ""; /* è·å¾—ç„¦ç‚¹æ—¶éšè—æç¤ºæ–‡å­— */
    }
      

    #canvas {
      border: 1px solid #aaa;
      cursor: crosshair;                        /*åå­—å…‰æ ‡*/
      background-color: white;
      border-radius: 4px;
      display: block;
      margin-bottom: 10px;
      touch-action: none;                       /* é˜²æ­¢è§¦æ‘¸è®¾å¤‡ä¸Šçš„é»˜è®¤è¡Œä¸º ï¼ˆæ¯”å¦‚æ»šåŠ¨ç¼©æ”¾ç­‰ï¼‰*/
    }

    .toolbar {
      display: flex;                            /*å¼¹æ€§å¸ƒå±€å®¹å™¨ï¼ˆå­å…ƒç´ é»˜è®¤æ’æˆä¸€è¡Œï¼‰*/
      flex-wrap: wrap;                          /*å…è®¸æ¢è¡Œ*/
      gap: 10px;                                /*å­å…ƒç´ é—´è·*/
      align-items: center;                      /*å‚ç›´å±…ä¸­å¯¹é½*/
    }

      .toolbar button {
          padding: 8px 12px;
          background-color: #3498db;
          color: white;
          border: none;                         /*ç§»é™¤æŒ‰é’®çš„é»˜è®¤è¾¹æ¡†*/
          border-radius: 4px;
          cursor: pointer;
          transition: background-color 0.3s;    /*å½“èƒŒæ™¯é¢œè‰²å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”¨0 .3ç§’çš„æ—¶é—´å¹³æ»‘è¿‡æ¸¡ï¼Œè€Œä¸æ˜¯ç¬é—´åˆ‡æ¢*/
      }

    .toolbar button:hover {                     /*é¼ æ ‡æ‚¬åœæ—¶ä½œç”¨*/
      background-color: #2980b9;
    }

    .preview-img, .preview-audio {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 4px;
    }

    .emoji {
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    .canvas-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    .canvas-controls button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    #insert-doodle {
      background-color: #2ecc71;
      color: white;
    }
    
    #insert-doodle:hover {
      background-color: #27ae60;
    }
    
    #clear-canvas {
      background-color: #e74c3c;
      color: white;
    }
    
    #clear-canvas:hover {
      background-color: #c0392b;
    }
    
    .file-input-label {
      display: inline-block;                 /*åŒæ—¶å…·æœ‰è¡Œå†…å…ƒç´ å’Œå—çº§å…ƒç´ ç‰¹æ€§*/
      padding: 8px 15px;
      background-color: #9b59b6;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .file-input-label:hover {
      background-color: #8e44ad;
    }

      input[type="file"] {
          display: none;                    /*éšè—æ‰€æœ‰ç±»å‹ä¸ºfileçš„è¾“å…¥æ¡†*/
      }
    
    .section-title {
      font-size: 18px;
      color: #2c3e50;
      margin-top: 25px;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eaeaea;
    }

        /* æ¶‚é¸¦å·¥å…·æ ·å¼ */
    .doodle-tools {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      align-items: center;
    }

    .color-picker {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .color-option {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: transform 0.2s;
    }

    .color-option:hover {
      transform: scale(1.2);
    }

    .color-option.active {
      border-color: #333;
      transform: scale(1.2);
    }

    .brush-size {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brush-size label {
      margin-bottom: 0;
      white-space: nowrap;
    }

    .brush-size input {
      width: 150px;
    }

    .brush-preview {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
    }
  </style>
</head>
<body>
    <!--ä¸»æ ‡é¢˜-->
  <h1>æˆ‘çš„å¤šåª’ä½“æ—¥è®°</h1>

    <!--æ—¥æœŸæ—¶é—´-->
  <div class="form-group">
      <label>æ—¶é—´:</label>
      <input type="datetime-local" id="time">
    <!--æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ï¼ˆæµè§ˆå™¨ä¼šä¸º<input type="datetime-local">æä¾›æ—¥å†æ ·å¼çš„æ—¶é—´è®¾ç½®å™¨ï¼Œæ˜¯åŸç”ŸUIç»„ä»¶ï¼‰-->
  </div>

    <!--å¤©æ°”-->
  <div class="form-group">
    <label>å¤©æ°”:</label>
    <select id="weather">
        <option>â˜€ï¸ æ™´</option>
        <option>â›… å¤šäº‘</option>
        <option>ğŸŒ§ï¸ é›¨</option>
        <option>ğŸŒ¨ï¸ é›ª</option>
        <!-- ä¸‹æ‹‰é€‰æ‹©æ¡† -->
    </select>
  </div>

    <!--å¿ƒæƒ…-->
  <div class="form-group">
    <label>å¿ƒæƒ…:</label>
    <select id="mood">
      <option>ğŸ˜Š å¼€å¿ƒ</option>
      <option>ğŸ˜” éš¾è¿‡</option>
      <option>ğŸ˜  ç”Ÿæ°”</option>
      <option>ğŸ˜Œ å¹³é™</option>
    </select>
  </div>

    <!--åœ°ç‚¹-->
  <div class="form-group">
      <label>åœ°ç‚¹:</label>
      <input type="text" id="location" placeholder="è¯·è¾“å…¥åœ°ç‚¹">
      <!--placeholderï¼šæä¾›æç¤ºæ–‡å­—-->
  </div>

    <!--æ—¥è®°æ–‡æœ¬è¾“å…¥æ¡†-->
  <div class="form-group">
    <label>äº‹ä»¶ä¸æ„Ÿæƒ³:</label>
    <div id="diary-content" contenteditable="true" ></div>
  </div>

  <div class="section-title">æ’å…¥å¤šåª’ä½“å†…å®¹</div>
  
    <!--è¡¨æƒ…æ’å…¥éƒ¨åˆ†-->
  <div class="form-group toolbar">
    <label>æ’å…¥è¡¨æƒ…ï¼š</label>
    <button onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</button>
    <button onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</button>
    <button onclick="insertEmoji('â¤ï¸')">â¤ï¸</button>
    <button onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
    <button onclick="insertEmoji('ğŸ‰')">ğŸ‰</button>
  </div>

    <!--å›¾ç‰‡éŸ³é¢‘æ’å…¥éƒ¨åˆ†-->
  <div class="form-group toolbar">
      <label>æ’å…¥åª’ä½“ï¼š</label>
      <label for="imageInput" class="file-input-label">é€‰æ‹©å›¾ç‰‡</label>             <!--for="imageInput" - å…³è”åˆ°IDä¸ºimageInputçš„æ–‡ä»¶è¾“å…¥æ¡†ï¼Œå› ä¸ºéšè—äº†æ–‡ä»¶è¾“å…¥æ¡†-->
      <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" />
                                                                                    <!-- å›¾ç‰‡ä¸Šä¼ è¾“å…¥ï¼Œåªæ¥å—å›¾ç‰‡æ–‡ä»¶ï¼Œå˜åŒ–æ—¶è°ƒç”¨insertImage -->

      <label for="audioInput" class="file-input-label">é€‰æ‹©éŸ³é¢‘</label>
      <input type="file" id="audioInput" accept="audio/*" onchange="insertAudio()" />
  </div>

    <!--æ¶‚é¸¦éƒ¨åˆ†-->
  <div class="form-group">
      <label>æ¶‚é¸¦æ¿:</label><br>

      <!--æ¶‚é¸¦å·¥å…·åŒºåŸŸ-->
      <div class="doodle-tools">
          <div class="color-picker">
              <label>é¢œè‰²:</label>
              <div class="color-option active" style="background-color: #000000;" data-color="#000000"></div>
              <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
              <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
              <div class="color-option" style="background-color: #008000;" data-color="#008000"></div>
              <div class="color-option" style="background-color: #ffff00;" data-color="#ffff00"></div>
              <div class="color-option" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
          </div>

          <div class="brush-size">
              <label>ç¬”ç”»ç²—ç»†:</label>
              <input type="range" id="brushSize" min="1" max="20" value="3">
              <div class="brush-preview" id="brushPreview" style="background-color: #000000;"></div>
          </div>
      </div>

      <canvas id="canvas" width="300" height="200"></canvas>
      <div class="canvas-controls">
          <button id="insert-doodle" onclick="insertDoodle()">æ’å…¥æ¶‚é¸¦åˆ°æ—¥è®°</button>
          <button id="clear-canvas" onclick="clearCanvas()">æ¸…ç©ºç”»å¸ƒ</button>
      </div>
  </div>

  <script>
    function insertEmoji(emoji) {
      const content = document.getElementById("diary-content");
      content.innerHTML += emoji;
    }

    function insertImage() {
      const input = document.getElementById("imageInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><img src="${e.target.result}" class="preview-img"><br>`;
      };
      reader.readAsDataURL(file);
    }

    function insertAudio() {
      const input = document.getElementById("audioInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><audio controls class="preview-audio"><source src="${e.target.result}" type="${file.type}"></audio><br>`;
      };
      reader.readAsDataURL(file);
    }

    // æ¶‚é¸¦åŠŸèƒ½
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;

    /*è®°å½•ä½ç½®ä¿¡æ¯ï¼Œæ”¹è¿›æ¶‚é¸¦è¿ç»­æ€§*/
    let lastX = 0;
    let lastY = 0;
    let currentColor = "#000000";
    let brushSize = 3;

      // åˆå§‹åŒ–æ¶‚é¸¦è®¾ç½®
    function initDoodle() {
      // è®¾ç½®é¢œè‰²é€‰é¡¹ç‚¹å‡»äº‹ä»¶
      document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
          // ç§»é™¤æ‰€æœ‰activeç±»
          document.querySelectorAll('.color-option').forEach(opt => {
            opt.classList.remove('active');
          });
          // æ·»åŠ activeç±»åˆ°å½“å‰é€‰é¡¹
          this.classList.add('active');
          // æ›´æ–°å½“å‰é¢œè‰²
          currentColor = this.getAttribute('data-color');
          // æ›´æ–°ç”»ç¬”é¢„è§ˆé¢œè‰²
          document.getElementById('brushPreview').style.backgroundColor = currentColor;
        });
      });
  
      // è®¾ç½®ç¬”ç”»ç²—ç»†å˜åŒ–äº‹ä»¶
      document.getElementById('brushSize').addEventListener('input', function() {
        brushSize = parseInt(this.value);
        // æ›´æ–°ç”»ç¬”é¢„è§ˆå¤§å°
        const preview = document.getElementById('brushPreview');
        preview.style.width = brushSize * 2 + 'px';
        preview.style.height = brushSize * 2 + 'px';
        preview.textContent = brushSize;
      });
  
      // åˆå§‹åŒ–ç”»ç¬”é¢„è§ˆ
      document.getElementById('brushPreview').style.width = brushSize * 2 + 'px';
      document.getElementById('brushPreview').style.height = brushSize * 2 + 'px';
      document.getElementById('brushPreview').textContent = brushSize;
    }

    // æ”¹è¿›çš„ç»˜å›¾å‡½æ•° - ä½¿ç”¨çº¿æ¡è¿æ¥ç‚¹ï¼Œä½¿ç¬”ç”»æ›´è¿ç»­
    function draw(e) {
      if (!drawing) return;
  
      // è·å–é¼ æ ‡ä½ç½®
      let x, y;
      if (e.type.includes('touch')) {
        // è§¦æ‘¸äº‹ä»¶
        const rect = canvas.getBoundingClientRect();
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
      } else {
        // é¼ æ ‡äº‹ä»¶
        x = e.offsetX;
        y = e.offsetY;
      }
  
      // è®¾ç½®ç»˜å›¾æ ·å¼
      ctx.strokeStyle = currentColor;
      ctx.lineWidth = brushSize;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
  
      // å¼€å§‹ç»˜åˆ¶è·¯å¾„
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
  
      // æ›´æ–°æœ€åä½ç½®
      lastX = x;
      lastY = y;
    }

    // å¼€å§‹ç»˜åˆ¶
    function startDrawing(e) {
      drawing = true;
  
      // è·å–èµ·å§‹ä½ç½®
      if (e.type.includes('touch')) {
        const rect = canvas.getBoundingClientRect();
        lastX = e.touches[0].clientX - rect.left;
        lastY = e.touches[0].clientY - rect.top;
      } else {
        lastX = e.offsetX;
        lastY = e.offsetY;
      }
    }

    // åœæ­¢ç»˜åˆ¶
    function stopDrawing() {
      drawing = false;
      // å¼€å§‹æ–°çš„è·¯å¾„
      ctx.beginPath();
    }

    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseout", stopDrawing);
    canvas.addEventListener("mousemove", draw);

    // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
    canvas.addEventListener("touchstart", startDrawing);
    canvas.addEventListener("touchend", stopDrawing);
    canvas.addEventListener("touchcancel", stopDrawing);
    canvas.addEventListener("touchmove", draw);

    function insertDoodle() {
      const content = document.getElementById("diary-content");
      const dataURL = canvas.toDataURL();
      content.innerHTML += `<br><img src="${dataURL}" class="preview-img"><br>`;
      clearCanvas();
    }

    // æ¸…ç©ºç”»å¸ƒåŠŸèƒ½
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
      // åˆå§‹åŒ–æ¶‚é¸¦åŠŸèƒ½
      initDoodle();

   /* // åˆå§‹åŒ–æ—¶é—´ä¸ºå½“å‰
      window.onload = () => {
      const now = new Date();
      const local = now.toISOString().slice(0,16);
      document.getElementById("time").value = local;
    }*/

      //ä¿®æ”¹è·å–å½“å‰æ—¶é—´çš„æ–¹æ³•ï¼ŒDate() è¿”å›çš„æ˜¯UTCæ—¶é—´ï¼ˆåè°ƒä¸–ç•Œæ—¶ï¼‰ä¸ç”¨æˆ·çš„å½“åœ°æ—¶é—´ä¸åŒ
      function getLocalDateTimeSimple() {
          const now = new Date();
          // è°ƒæ•´æ—¶åŒºåç§»
          now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
          //now.getTimezoneOffset()è¿”å›æœ¬åœ°æ—¶é—´ä¸UTCæ—¶é—´çš„åˆ†é’Ÿå·®å€¼
          return now.toISOString().slice(0, 16);
      }

      window.onload = () => {
          document.getElementById("time").value = getLocalDateTimeSimple();
      };
  </script>
</body>
</html>