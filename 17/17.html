<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„å¤šåª’ä½“æ—¥è®°</title>
  <style>
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
        --card-bg: #ffffff;
        --text-color: #333;
        --border-color: #e0e0e0;
        --shadow: 0 4px 6px rgba(0,0,0,0.1);
        --hover-shadow: 0 8px 15px rgba(0,0,0,0.2);
    }
    /* ä¸»é¢˜é¢œè‰² */
    body.theme-blue {
        --primary-color: #3fb2ff;
        --secondary-color: #3fb2ff;
        --background-gradient: linear-gradient(135deg, #DEFCFF 0%, #076CAB 100%);
    }

    body.theme-green {
        --primary-color: #5bad77;
        --secondary-color: #5bad77;
        --background-gradient: linear-gradient(135deg, #fbffdf 0%, #4A7c59 100%);
    }

    body.theme-purple {
        --primary-color: #7f4795;
        --secondary-color: #7f4795;
        --background-gradient: linear-gradient(135deg, #edd1ff 0%, #592770 100%);
    }

    body.theme-pink {
        --primary-color: #Eaafc8;
        --secondary-color: #Eaafc8;
        --background-gradient: linear-gradient(135deg, #ffefe0 0%, #de95ba 100%);
    }

    body.theme-orange {
        --primary-color: #f8972e;
        --secondary-color: #f8972e;
        --background-gradient: linear-gradient(135deg, #fefec1 0%, #dc6333 100%);
    }

    body {
        font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, sans-serif;
        background: var(--background-gradient);
        min-height: 100vh;
        padding: 20px;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        flex: 1;  
        display: flex;       
        flex-direction: column;
    }

    .header {
        background: var(--card-bg);
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: var(--shadow);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }

    .header h1 {
        color: var(--primary-color);
        font-size: 2em;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .theme-switcher {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .theme-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 1px transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(109, 109, 109, 0.15);
    }

    .theme-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    .theme-btn.active {
        border-color: rgba(255, 255, 255, 0.9);
        box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .theme-blue-btn { background: linear-gradient(135deg, #DEFCFF 0%, #076CAB 100%); }
    .theme-green-btn { background: linear-gradient(135deg, #fbffdf 0%, #4A7c59 100%); }
    .theme-purple-btn { background: linear-gradient(135deg, #edd1ff 0%, #592770 100%); }
    .theme-pink-btn { background: linear-gradient(135deg, #ffefe0 0%, #de95ba 100%); }
    .theme-orange-btn { background: linear-gradient(135deg, #fefec1 0%, #ee8b63 100%); }

    .main-content {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
        align-items: start;
        flex:1;
        align-items: stretch;
    }

    .sidebar {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 20px;
        box-shadow: var(--shadow);
        position: sticky;
        top: 20px;
    }

    .sidebar-section {
        margin-bottom: 25px;
    }

    .sidebar-section h3 {
        color: var(--primary-color);
        margin-bottom: 12px;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #666;
        font-size: 1.1em;
        font-weight: 500;
    }

    input[type="datetime-local"],
    input[type="text"],
    select {
        width: 100%;
        padding: 10px 12px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 0.95em;
        transition: all 0.3s ease;
    }

    input:focus,
    select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    .editor-area {
        background: var(--card-bg);
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
    }

    .toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 20px;
        border: 2px solid var(--border-color);
    }

    .toolbar-group {
        display: flex;
        gap: 5px;
        padding: 0 10px;
        border-right: 2px solid var(--border-color);
    }

    .toolbar-group:last-child {
        border-right: none;
    }

    .toolbar-btn {
        padding: 8px 12px;
        border: none;
        background: white;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .toolbar-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    .toolbar-btn.active {
        background: var(--primary-color);
        color: white;
    }

    select.toolbar-select {
        padding: 6px 10px;
        border: 2px solid var(--border-color);
        border-radius: 6px;
        background: white;
        cursor: pointer;
    }

    input[type="color"] {
        width: 40px;
        height: 35px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    #contentArea {
        flex:1;
        min-height: 400px;
        padding: 20px;
        border: 2px solid var(--border-color);
        border-radius: 10px;
        background: white;
        font-size: 1em;
        line-height: 1.8;
        margin-bottom: 20px;
    }

    #contentArea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    }

    .media-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
        flex-shrink: 0;
    }

    .media-btn {
        padding: 12px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.95em;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .media-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: var(--hover-shadow);
        filter: brightness(1.1);
    }

    .media-preview {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .media-item {
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: all 0.3s ease;
    }

    .media-item:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
    }

    .media-item img,
    .media-item video {
        width: 100%;
        height: 150px;
        object-fit: cover;
        display: block;
    }

    .media-item audio {
        width: 100%;
    }

    .media-delete {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(255, 0, 0, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        cursor: pointer;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .canvas-container {
        border: 2px solid var(--border-color);
        border-radius: 10px;
        margin-bottom: 20px;
        background: white;
        padding: 15px;
    }

    .canvas-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        flex-wrap: wrap;
        align-items: center;
    }

    canvas {
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        cursor: crosshair;
        display: block;
        width: 100%;
        background: white;
    }

    .save-button-wrapper {
        display: flex;
        justify-content: flex-end;
        margin-top: 25px;
    }

    .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: var(--hover-shadow);
        filter: brightness(1.1);
    }

    .word-count {
        text-align: right;
        color: #666;
        font-size: 0.9em;
        margin-top: 15px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }

    .emoji-picker {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .emoji-btn {
        font-size: 1.8em;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.2s ease;
    }

    .emoji-btn:hover {
        background: #f0f0f0;
        transform: scale(1.25);
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: var(--hover-shadow);
        z-index: 1000;
        animation: slideIn 0.3s ease;
    }
    /* â­ æ–°å¢ï¼šåº•éƒ¨é¡µè„š */
    .editor-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
        flex-shrink: 0;
        flex-wrap: wrap;
    }

    .word-count {
        color: #666;
        font-size: 0.9em;
    }

    .save-button-wrapper {
        display: flex;
        gap: 10px;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        white-space: nowrap;
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: var(--hover-shadow);
        filter: brightness(1.1);
    }

    .unsaved-warning {
        position: fixed;
        top: 80px;
        right: 20px;
        background: #FFF3CD;
        border: 2px solid #FFC107;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        z-index: 999;
        animation: slideIn 0.3s ease;
        display: none;
        align-items: center;
        gap: 10px;
        font-size: 0.95em;
    }

    .unsaved-warning.show {
        display: flex;
    }

    .unsaved-warning-icon {
        font-size: 1.2em;
    }

    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .hidden {
        display: none;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 968px) {
        .main-content {
            grid-template-columns: 1fr;
        }

        .sidebar {
            position: static;
        }

        .toolbar {
            overflow-x: auto;
        }

        .header {
            flex-direction: column;
            gap: 15px;
        }
    }

    /* æ–‡ä»¶è¾“å…¥ç¾åŒ– */
    input[type="file"] {
        display: none;
    }

    .file-label {
        display: inline-block;
        padding: 10px 20px;
        background: var(--primary-color);
        color: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .file-label:hover {
        background: var(--secondary-color);
    }
  </style>
</head>

<body class="theme-blue">
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>
                ğŸ“ æˆ‘çš„å¤šåª’ä½“æ—¥è®°
            </h1>
            <div class="theme-switcher">
                <span style="color: #666; font-size: 0.9em;">ä¸»é¢˜:</span>
                <button class="theme-btn theme-blue-btn active" onclick="changeTheme('blue')" title="è“è‰²ä¸»é¢˜"></button>
                <button class="theme-btn theme-green-btn" onclick="changeTheme('green')" title="ç»¿è‰²ä¸»é¢˜"></button>
                <button class="theme-btn theme-purple-btn" onclick="changeTheme('purple')" title="ç´«è‰²ä¸»é¢˜"></button>
                <button class="theme-btn theme-pink-btn" onclick="changeTheme('pink')" title="ç²‰è‰²ä¸»é¢˜"></button>
                <button class="theme-btn theme-orange-btn" onclick="changeTheme('orange')" title="æ©™è‰²ä¸»é¢˜"></button>
            </div>
        </div>

        <!-- å†…å®¹ -->
        <div class="main-content">
            <!-- å·¦ä¾§è¾¹æ  -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3>ğŸ“ åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-group">
                        <label>ğŸ•› æ—¶é—´</label>
                        <input type="datetime-local" id="diaryTime">
                    </div>
                    <div class="form-group">
                        <label>ğŸŒˆ å¤©æ°”</label>
                        <select id="weather">
                            <option value="â˜€ï¸ æ™´">â˜€ï¸ æ™´</option>
                            <option value="â›… å¤šäº‘">â›… å¤šäº‘</option>
                            <option value="ğŸŒ§ï¸ é›¨">ğŸŒ§ï¸ é›¨</option>
                            <option value="ğŸŒ¨ï¸ é›ª">ğŸŒ¨ï¸ é›ª</option>
                            <option value="â›ˆï¸ é›·é˜µé›¨">â›ˆï¸ é›·é˜µé›¨</option>
                            <option value="ğŸŒ«ï¸ é›¾">ğŸŒ«ï¸ é›¾</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ’– å¿ƒæƒ…</label>
                        <select id="mood">
                            <option value="ğŸ˜Š å¼€å¿ƒ">ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="ğŸ˜Œ æ¬£æ…°">ğŸ˜Œ æ¬£æ…°</option>
                            <option value="ğŸ˜” éš¾è¿‡">ğŸ˜” éš¾è¿‡</option>
                            <option value="ğŸ˜  ç”Ÿæ°”">ğŸ˜  ç”Ÿæ°”</option>
                            <option value="ğŸ˜° ç„¦è™‘">ğŸ˜° ç„¦è™‘</option>
                            <option value="ğŸ¤” æ€è€ƒ">ğŸ¤” æ€è€ƒ</option>
                            <option value="ğŸ˜´ å›°å€¦">ğŸ˜´ å›°å€¦</option>
                            <option value="ğŸ¥³ å…´å¥‹">ğŸ¥³ å…´å¥‹</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ“ åœ°ç‚¹</label>
                        <input type="text" id="location" placeholder="è®°å½•åœ°ç‚¹...">
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>ğŸ’« è¡¨æƒ…</h3>
                    <div class="emoji-picker">
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ¥²')">ğŸ¥²</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ˜‡')">ğŸ˜‡</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ¥¹')">ğŸ¥¹</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ¥°')">ğŸ¥°</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ˜‹')">ğŸ˜‹</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ™')">ğŸ™</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ˜®')">ğŸ˜®</button>

                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘‹')">ğŸ‘‹</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ™')">ğŸ™</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’ª')">ğŸ’ª</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘Œ')">ğŸ‘Œ</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘Š')">ğŸ‘Š</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ‘€')">ğŸ‘€</button>

                        <button class="emoji-btn" onclick="insertEmoji('ğŸ•')">ğŸ•</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸˆ')">ğŸˆ</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸŒ¹')">ğŸŒ¹</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ¥€')">ğŸ¥€</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’”')">ğŸ’”</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’—')">ğŸ’—</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸŒŸ')">ğŸŒŸ</button>
                        <button class="emoji-btn" onclick="insertEmoji('âœ¨')">âœ¨</button>

                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’¦')">ğŸ’¦</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’¤')">ğŸ’¤</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸŒˆ')">ğŸŒˆ</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ’¡')">ğŸ’¡</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ”¥')">ğŸ”¥</button>
                        <button class="emoji-btn" onclick="insertEmoji('â­')">â­</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸµ')">ğŸµ</button>
                        <button class="emoji-btn" onclick="insertEmoji('ğŸ€')">ğŸ€</button>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ç¼–è¾‘åŒº -->
            <div class="editor-area">
                <!-- æ–‡æœ¬å·¥å…·æ  -->
                <div class="toolbar">
                    <div class="toolbar-group">
                        <select class="toolbar-select" id="fontFamily" onchange="formatText('fontName', this.value)">
                            <option value="å¾®è½¯é›…é»‘">å¾®è½¯é›…é»‘</option>
                            <option value="å®‹ä½“">å®‹ä½“</option>
                            <option value="é»‘ä½“">é»‘ä½“</option>
                            <option value="æ¥·ä½“">æ¥·ä½“</option>
                            <option value="Arial">Arial</option>
                        </select>
                        <select class="toolbar-select" id="fontSize" onchange="formatText('fontSize', this.value)">
                            <option value="1">æå°</option>
                            <option value="2">å°</option>
                            <option value="3" selected>æ­£å¸¸</option>
                            <option value="4">å¤§</option>
                            <option value="5">æå¤§</option>
                            <option value="6">æ ‡é¢˜</option>
                        </select>
                    </div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="formatText('bold')" title="ç²—ä½“"><b>B</b></button>
                        <button class="toolbar-btn" onclick="formatText('italic')" title="æ–œä½“"><i>I</i></button>
                        <button class="toolbar-btn" onclick="formatText('underline')" title="ä¸‹åˆ’çº¿"><u>U</u></button>
                        <button class="toolbar-btn" onclick="formatText('strikeThrough')" title="åˆ é™¤çº¿"><s>S</s></button>
                    </div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="formatText('justifyLeft')" title="å·¦å¯¹é½">â‰¡</button>
                        <button class="toolbar-btn" onclick="formatText('justifyCenter')" title="å±…ä¸­">â‰£</button>
                        <button class="toolbar-btn" onclick="formatText('justifyRight')" title="å³å¯¹é½">â‰¡</button>
                    </div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="formatText('insertOrderedList')" title="æœ‰åºåˆ—è¡¨">1. 2. 3.</button>
                        <button class="toolbar-btn" onclick="formatText('insertUnorderedList')" title="æ— åºåˆ—è¡¨">â€¢ â€¢ â€¢</button>
                    </div>

                    <div class="toolbar-group">
                        <input type="color" id="textColor" onchange="formatText('foreColor', this.value)" title="æ–‡å­—é¢œè‰²">
                        <input type="color" id="bgColor" onchange="formatText('backColor', this.value)" title="èƒŒæ™¯é¢œè‰²">
                    </div>

                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="formatText('undo')" title="æ’¤é”€">â†¶</button>
                        <button class="toolbar-btn" onclick="formatText('redo')" title="é‡åš">â†·</button>
                    </div>
                </div>

                <!-- å†…å®¹ç¼–è¾‘åŒº -->
                <div id="contentArea" contenteditable="true" placeholder="å¼€å§‹è®°å½•ä½ çš„ç”Ÿæ´»..."></div>
                
                <div class="word-count">
                    å­—æ•°ç»Ÿè®¡: <span id="wordCount">0</span> å­—
                </div>

                <!-- åª’ä½“æ§åˆ¶æŒ‰é’® -->
                <div class="media-controls">
                    <label for="imageInput" class="media-btn">
                        ğŸ–¼ï¸ æ’å…¥å›¾ç‰‡
                    </label>
                    <input type="file" id="imageInput" accept="image/*" multiple onchange="handleImageUpload(event)">

                    <label for="videoInput" class="media-btn">
                        ğŸ¬ æ’å…¥è§†é¢‘
                    </label>
                    <input type="file" id="videoInput" accept="video/*" onchange="handleVideoUpload(event)">

                    <label for="audioInput" class="media-btn">
                        ğŸµ æ’å…¥è¯­éŸ³
                    </label>
                    <input type="file" id="audioInput" accept="audio/*" onchange="handleAudioUpload(event)">

                    <button class="media-btn" onclick="toggleCanvas()">
                        ğŸ¨ æ¶‚é¸¦ç”»æ¿
                    </button>
                </div>

                <!-- åª’ä½“é¢„è§ˆåŒº -->
                <div class="media-preview" id="mediaPreview"></div>

                <!-- æ¶‚é¸¦ç”»æ¿ -->
                <div class="canvas-container hidden" id="canvasContainer">
                    <h3 style="color: var(--primary-color); margin-bottom: 10px;">ğŸ¨ æ¶‚é¸¦ç”»æ¿</h3>
                    <div class="canvas-controls">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            ç”»ç¬”é¢œè‰²:
                            <input type="color" id="brushColor" value="#000000">
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px;">
                            ç”»ç¬”ç²—ç»†:
                            <input type="range" id="brushSize" min="1" max="20" value="3" style="width: 100px;">
                            <span id="brushSizeValue">3</span>px
                        </label>
                        <button class="toolbar-btn" onclick="undoDraw()">â†¶ æ’¤é”€</button>
                        <button class="toolbar-btn" onclick="redoDraw()">â†· é‡åš</button>
                        <button class="toolbar-btn" onclick="clearCanvas()">ğŸ—‘ï¸ æ¸…ç©º</button>
                        <button class="media-btn" onclick="saveCanvas()">ğŸ’¾ ä¿å­˜æ¶‚é¸¦</button>
                    </div>
                    <canvas id="drawCanvas" width="800" height="400"></canvas>
                </div>
            </div>
        </div>

        <!-- ä¿å­˜æŒ‰é’®ç§»åˆ°å¤–é¢ -->
        <div class="save-button-wrapper">
            <button class="btn btn-primary" onclick="exportDiary()">
                ğŸ’¾ ä¿å­˜æ—¥è®°
            </button>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ—¶é—´
        document.getElementById('diaryTime').value = new Date().toISOString().slice(0, 16);

        // å­˜å‚¨åª’ä½“æ–‡ä»¶
        let mediaFiles = [];
        let hasUnsavedChanges = false;

        // ç”»å¸ƒç›¸å…³
        let canvas, ctx;
        let isDrawing = false;
        let drawHistory = [];
        let historyStep = -1;

        // ç›‘å¬å†…å®¹å˜åŒ–
        document.getElementById('contentArea').addEventListener('input', function() {
            hasUnsavedChanges = true;
            const text = this.innerText || this.textContent;
            const count = text.trim().length;
            document.getElementById('wordCount').textContent = count;
        });

        // ç›‘å¬å…¶ä»–è¾“å…¥å˜åŒ–
        ['diaryTime', 'weather', 'mood', 'location'].forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                hasUnsavedChanges = true;
            });
        });

        //æ·»åŠ é¡µé¢å…³é—­å‰æç¤º
        window.addEventListener('beforeunload', function(e) {
            const content = document.getElementById('contentArea').innerText.trim();
            const hasMedia = mediaFiles.length > 0;
            
            if (hasUnsavedChanges && (content.length > 0 || hasMedia)) {
                e.preventDefault();
                e.returnValue = 'æ‚¨æœ‰æœªä¿å­˜çš„æ—¥è®°å†…å®¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
                return 'æ‚¨æœ‰æœªä¿å­˜çš„æ—¥è®°å†…å®¹ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
        });

        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            canvas = document.getElementById('drawCanvas');
            ctx = canvas.getContext('2d');
            
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseout', stopDraw);

            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDraw);

            document.getElementById('brushSize').addEventListener('input', function() {
                document.getElementById('brushSizeValue').textContent = this.value;
            });

            saveCanvasState();
        }

        function startDraw(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            ctx.strokeStyle = document.getElementById('brushColor').value;
            ctx.lineWidth = document.getElementById('brushSize').value;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
        }

        function stopDraw() {
            if (isDrawing) {
                isDrawing = false;
                saveCanvasState();
            }
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 'mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function saveCanvasState() {
            historyStep++;
            if (historyStep < drawHistory.length) {
                drawHistory.length = historyStep;
            }
            drawHistory.push(canvas.toDataURL());
        }

        function undoDraw() {
            if (historyStep > 0) {
                historyStep--;
                restoreCanvasState();
            }
        }

        function redoDraw() {
            if (historyStep < drawHistory.length - 1) {
                historyStep++;
                restoreCanvasState();
            }
        }

        function restoreCanvasState() {
            const img = new Image();
            img.src = drawHistory[historyStep];
            img.onload = function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
        }

        function clearCanvas() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç”»æ¿å—?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveCanvasState();
            }
        }

        function saveCanvas() {
            const dataURL = canvas.toDataURL('image/png');
            const item = {
                type: 'image',
                data: dataURL,
                name: 'æ¶‚é¸¦_' + new Date().getTime()
            };
            mediaFiles.push(item);
            displayMediaItem(item, mediaFiles.length - 1);
            showNotification('æ¶‚é¸¦å·²ä¿å­˜!');
            toggleCanvas();
            hasUnsavedChanges = true;
        }

        function toggleCanvas() {
            const container = document.getElementById('canvasContainer');
            container.classList.toggle('hidden');
            if (!container.classList.contains('hidden') && !canvas) {
                initCanvas();
            }
        }

        // å¯Œæ–‡æœ¬ç¼–è¾‘
        function formatText(command, value) {
            document.execCommand(command, false, value);
            document.getElementById('contentArea').focus();
        }

        // æ’å…¥è¡¨æƒ…
        function insertEmoji(emoji) {
            const contentArea = document.getElementById('contentArea');
            contentArea.focus();
            document.execCommand('insertText', false, emoji);
        }

        // å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const item = {
                            type: 'image',
                            data: e.target.result,
                            name: file.name
                        };
                        mediaFiles.push(item);
                        displayMediaItem(item, mediaFiles.length - 1);
                        hasUnsavedChanges = true;
                    };
                    reader.readAsDataURL(file);
                }
            }
            showNotification(`æˆåŠŸä¸Šä¼  ${files.length} å¼ å›¾ç‰‡!`);
            event.target.value = '';
        }

        // è§†é¢‘ä¸Šä¼ 
        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type.startsWith('video/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const item = {
                        type: 'video',
                        data: e.target.result,
                        name: file.name
                    };
                    mediaFiles.push(item);
                    displayMediaItem(item, mediaFiles.length - 1);
                    showNotification('è§†é¢‘ä¸Šä¼ æˆåŠŸ!');
                    hasUnsavedChanges = true;
                };
                reader.readAsDataURL(file);
            }
            event.target.value = '';
        }

        // è¯­éŸ³ä¸Šä¼ 
        function handleAudioUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type.startsWith('audio/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const item = {
                        type: 'audio',
                        data: e.target.result,
                        name: file.name
                    };
                    mediaFiles.push(item);
                    displayMediaItem(item, mediaFiles.length - 1);
                    showNotification('è¯­éŸ³ä¸Šä¼ æˆåŠŸ!');
                    hasUnsavedChanges = true;
                };
                reader.readAsDataURL(file);
            }
            event.target.value = '';
        }

        // æ˜¾ç¤ºåª’ä½“é¡¹
        function displayMediaItem(item, index) {
            const preview = document.getElementById('mediaPreview');
            const div = document.createElement('div');
            div.className = 'media-item';
            
            let content = '';
            if (item.type === 'image') {
                content = `<img src="${item.data}" alt="${item.name}">`;
            } else if (item.type === 'video') {
                content = `<video src="${item.data}" controls></video>`;
            } else if (item.type === 'audio') {
                content = `<audio src="${item.data}" controls></audio>`;
            }
            
            div.innerHTML = `
                ${content}
                <button class="media-delete" onclick="deleteMedia(${index})">Ã—</button>
            `;
            preview.appendChild(div);
        }

        // åˆ é™¤åª’ä½“
        function deleteMedia(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåª’ä½“æ–‡ä»¶å—?')) {
                mediaFiles.splice(index, 1);
                refreshMediaPreview();
                showNotification('åª’ä½“æ–‡ä»¶å·²åˆ é™¤');
            }
        }

        // åˆ·æ–°åª’ä½“é¢„è§ˆ
        function refreshMediaPreview() {
            const preview = document.getElementById('mediaPreview');
            preview.innerHTML = '';
            mediaFiles.forEach((item, index) => {
                displayMediaItem(item, index);
            });
        }

        // æ”¶é›†æ—¥è®°æ•°æ®
        function collectDiaryData() {
            const timeInput = document.getElementById('diaryTime').value;
            // å°† ISO æ ¼å¼çš„æ—¶é—´ (2025-10-23T10:13) è½¬æ¢ä¸ºå¯è¯»æ ¼å¼
            const formattedTime = timeInput.replace('T', ' ');
            
            return {
                time: formattedTime,
                weather: document.getElementById('weather').value,
                mood: document.getElementById('mood').value,
                location: document.getElementById('location').value,
                content: document.getElementById('contentArea').innerHTML,
                media: mediaFiles,
                wordCount: document.getElementById('wordCount').textContent
            };
        }

        function exportDiary() {
            const diaryData = collectDiaryData();
            
            if (!diaryData.content.trim() && mediaFiles.length === 0) {
                alert('æ—¥è®°å†…å®¹ä¸èƒ½ä¸ºç©º!');
                return;
            }
            
            const html = generateHTMLExport(diaryData);
            downloadFile(html, `æ—¥è®°_${new Date().getTime()}.html`, 'text/html');
            showNotification('æ—¥è®°ä¿å­˜æˆåŠŸ! âœ…');
            hasUnsavedChanges = false;
        }

 // ç”ŸæˆHTMLå¯¼å‡º
function generateHTMLExport(data) {
    // è·å–å½“å‰ä¸»é¢˜
    const currentTheme = document.body.className.replace('theme-', '');
    
    // å®šä¹‰ä¸»é¢˜èƒŒæ™¯è‰²æ˜ å°„
    const themeBackgrounds = {
        'blue': 'linear-gradient(135deg, #DEFCFF 0%, #076CAB 100%)',
        'green': 'linear-gradient(135deg, #fbffdf 0%, #4A7c59 100%)',
        'purple': 'linear-gradient(135deg, #edd1ff 0%, #592770 100%)',
        'pink': 'linear-gradient(135deg, #ffefe0 0%, #de95ba 100%)',
        'orange': 'linear-gradient(135deg, #fefec1 0%, #dc6333 100%)'
    };
    
    // å®šä¹‰ä¸»é¢˜ä¸»è‰²è°ƒæ˜ å°„
    const themePrimaryColors = {
        'blue': '#3fb2ff',
        'green': '#5bad77',
        'purple': '#7f4795',
        'pink': '#Eaafc8',
        'orange': '#f8972e'
    };
    
    const themeBackground = themeBackgrounds[currentTheme];
    const themePrimaryColor = themePrimaryColors[currentTheme];
    
    return `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è®° - ${data.time}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            background: ${themeBackground};
            min-height: 100vh;
        }
        
        .diary-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .diary-header {
            border-bottom: 3px solid ${themePrimaryColor};
            padding-bottom: 30px;
            margin-bottom: 30px;
        }
        
        .diary-header h1 {
            color: ${themePrimaryColor};
            font-size: 2.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .meta-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 1em;
        }
        
        .meta-item {
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 8px;
            border-left: 4px solid ${themePrimaryColor};
        }
        
        .diary-content {
            font-size: 1.1em;
            line-height: 2;
            color: #333;
            margin: 30px 0;
            word-wrap: break-word;
        }
        
        .media-section {
            margin: 40px 0;
        }
        
        .media-section h2 {
            color: ${themePrimaryColor};
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .media-gallery img,
        .media-gallery video {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .media-gallery img:hover,
        .media-gallery video:hover {
            transform: scale(1.05);
        }
        
        .media-gallery audio {
            width: 100%;
            margin: 10px 0;
        }
        
        .export-info {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            color: #999;
            font-size: 0.9em;
        }
        
        @media print {
            body {
                background: white;
            }
        }
    </style>
</head>
<body>
    <div class="diary-container">
        <div class="diary-header">
            <h1>ğŸ“ æˆ‘çš„æ—¥è®°</h1>
            <div class="meta-info">
                <div class="meta-item">ğŸ“… ${data.time}</div>
                <div class="meta-item">${data.weather}</div>
                <div class="meta-item">${data.mood}</div>
                <div class="meta-item">ğŸ“ ${data.location || 'æœªè®°å½•'}</div>
                <div class="meta-item">ğŸ“Š ${data.wordCount} å­—</div>
            </div>
        </div>
        
        <div class="diary-content">
            ${data.content}
        </div>
        
        ${data.media.length > 0 ? `
        <div class="media-section">
            <h2>ğŸ“ é™„ä»¶èµ„æº</h2>
            <div class="media-gallery">
                ${data.media.map(item => {
                    if (item.type === 'image') return `<img src="${item.data}" alt="${item.name}">`;
                    if (item.type === 'video') return `<video src="${item.data}" controls></video>`;
                    if (item.type === 'audio') return `<audio src="${item.data}" controls></audio>`;
                    return '';
                }).join('')}
            </div>
        </div>
        ` : ''}
        
        <div class="export-info">
            âœ¨ ç”±å¤šåª’ä½“æ—¥è®°åº”ç”¨å¯¼å‡º Â· ${new Date().toLocaleString('zh-CN')} Â· ä¸»é¢˜: ${currentTheme}
        </div>
    </div>
</body>
</html>
    `;
}

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ä¸»é¢˜åˆ‡æ¢
        function changeTheme(theme) {
            document.body.className = `theme-${theme}`;
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.theme-${theme}-btn`).classList.add('active');
            localStorage.setItem('diaryTheme', theme);
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            const savedTheme = localStorage.getItem('diaryTheme') || 'blue';
            changeTheme(savedTheme);
        });
    </script>
  </body>
</html>