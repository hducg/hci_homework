<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æˆ‘çš„å¤šåª’ä½“æ—¥è®°</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #5b6bff;
      --secondary-color: #8a98ff;
      --accent-color: #ff6b8b;
      --light-color: #f7f9fc;
      --dark-color: #333;
      --border-color: #e0e6ff;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
      color: var(--dark-color);
      line-height: 1.6;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
      padding: 25px 30px;
      text-align: center;
      position: relative;
    }

    header h1 {
      font-size: 2.2rem;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    header p {
      opacity: 0.9;
      font-size: 1rem;
    }

    .diary-form {
      padding: 25px 30px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1;
      min-width: 200px;
    }

    label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: var(--dark-color);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(91, 107, 255, 0.1);
    }

    /* ä»Šæ—¥å¿ƒæƒ…æ€»ç»“æ ·å¼ */
    .mood-summary {
      background: linear-gradient(135deg, #fff9e6, #fff0cc);
      border: 1px solid #ffd966;
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 25px;
      position: relative;
    }

    .mood-summary::before {
      content: "âœ¨";
      position: absolute;
      top: -10px;
      left: 15px;
      font-size: 1.5rem;
      background: white;
      padding: 0 5px;
    }

    .mood-summary label {
      color: #d35400;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mood-summary-sentence {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 1.1rem;
      margin-bottom: 15px;
    }

    .mood-summary-input {
      width: auto;
      min-width: 120px;
      flex: 1;
      background: rgba(255, 255, 255, 0.7);
      border: 1px dashed #ffa94d;
    }

    .mood-summary-input:focus {
      border-style: solid;
      background: white;
    }

    .mood-summary-examples {
      font-size: 0.85rem;
      color: #666;
      margin-top: 10px;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 6px;
    }

    #diary-content {
      min-height: 250px;
      border: 1px solid var(--border-color);
      padding: 15px;
      background-color: white;
      border-radius: var(--radius);
      line-height: 1.8;
      overflow-y: auto;
      max-height: 400px;
    }

    #diary-content:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(91, 107, 255, 0.1);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      padding: 15px;
      background-color: #f1f8e9;
      border-radius: var(--radius);
    }

    .toolbar-section {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-right: 15px;
      border-right: 1px solid var(--border-color);
    }

    .toolbar-section:last-child {
      border-right: none;
    }

    .toolbar button {
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .toolbar button:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .doodle-section {
      margin-top: 20px;
      padding: 20px;
      background-color: #f1f8e9;
      border-radius: var(--radius);
    }

    .doodle-tools {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      align-items: center;
    }

    .color-picker {
      display: flex;
      gap: 5px;
    }

    .color-option {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .color-option.active {
      border-color: var(--dark-color);
    }

    #canvas {
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      cursor: crosshair;
      background: white;
      display: block;
    }

    .preview-img, .preview-audio {
      max-width: 100%;
      margin: 15px 0;
      border-radius: var(--radius);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .preview-audio {
      width: 100%;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: var(--radius);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #f0f2ff;
      color: var(--primary-color);
    }

    .btn-secondary:hover {
      background: #e4e8ff;
    }

    .btn-danger {
      background: #ff6b6b;
      color: white;
    }

    .btn-danger:hover {
      background: #ff5252;
    }

    .emoji-picker {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: var(--radius);
      border: 1px solid var(--border-color);
      max-height: 150px;
      overflow-y: auto;
    }

    .emoji {
      font-size: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .emoji:hover {
      transform: scale(1.2);
    }

    .entry-counter {
      text-align: right;
      margin-top: 10px;
      color: #666;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 15px;
      }
      
      .toolbar {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .toolbar-section {
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
        width: 100%;
      }
      
      .toolbar-section:last-child {
        border-bottom: none;
      }
      
      .actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .mood-summary-sentence {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .mood-summary-input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-book"></i> æˆ‘çš„å¤šåª’ä½“æ—¥è®°</h1>
      <p>è®°å½•ç”Ÿæ´»ä¸­çš„æ¯ä¸€ä¸ªç²¾å½©ç¬é—´</p>
    </header>

    <div class="diary-form">
      <div class="form-row">
        <div class="form-group">
          <label for="time"><i class="far fa-clock"></i> æ—¶é—´:</label>
          <input type="datetime-local" id="time">
        </div>

        <div class="form-group">
          <label for="weather"><i class="fas fa-cloud-sun"></i> å¤©æ°”:</label>
          <select id="weather">
            <option>â˜€ï¸ æ™´</option>
            <option>â›… å¤šäº‘</option>
            <option>ğŸŒ§ï¸ é›¨</option>
            <option>ğŸŒ¨ï¸ é›ª</option>
            <option>ğŸŒªï¸ å¤§é£</option>
            <option>â›ˆï¸ é›·é›¨</option>
            <option>ğŸŒ«ï¸ é›¾</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="mood"><i class="far fa-smile"></i> å¿ƒæƒ…:</label>
          <select id="mood">
            <option>ğŸ˜Š å¼€å¿ƒ</option>
            <option>ğŸ˜” éš¾è¿‡</option>
            <option>ğŸ˜  ç”Ÿæ°”</option>
            <option>ğŸ˜Œ å¹³é™</option>
            <option>ğŸ˜ å…´å¥‹</option>
            <option>ğŸ˜´ ç–²æƒ«</option>
            <option>ğŸ¤” æ€è€ƒ</option>
          </select>
        </div>

        <div class="form-group">
          <label for="location"><i class="fas fa-map-marker-alt"></i> åœ°ç‚¹:</label>
          <input type="text" id="location" placeholder="è¯·è¾“å…¥åœ°ç‚¹">
        </div>
      </div>

      <!-- ä»Šæ—¥å¿ƒæƒ…æ€»ç»“åŒºåŸŸ -->
      <div class="mood-summary">
        <label><i class="fas fa-heart"></i> ä»Šæ—¥å¿ƒæƒ…æ€»ç»“</label>
        <div class="mood-summary-sentence">
          <span>æˆ‘ä»Šå¤©æƒ³å¯¹</span>
          <input type="text" id="to-whom" class="mood-summary-input" placeholder="è° (ä¾‹å¦‚: å¦ˆå¦ˆã€æœ‹å‹ã€è‡ªå·±)">
          <span></span>
          <input type="text" id="do-what" class="mood-summary-input" placeholder="åšä»€ä¹ˆ (ä¾‹å¦‚: è¯´å£°è°¢è°¢ã€è¡¨è¾¾çˆ±æ„ã€åˆ†äº«å–œæ‚¦)">
        </div>
        <div class="mood-summary-examples">
          <strong>å¡«å†™ç¤ºä¾‹ï¼š</strong> æˆ‘ä»Šå¤©æƒ³å¯¹ <em>å¦ˆå¦ˆ</em> <em>è¯´å£°è°¢è°¢</em> | æˆ‘ä»Šå¤©æƒ³å¯¹ <em>è‡ªå·±</em> <em>è¯´å£°åŠ æ²¹</em> | æˆ‘ä»Šå¤©æƒ³å¯¹ <em>æœ‹å‹</em> <em>åˆ†äº«å¥½æ¶ˆæ¯</em>
        </div>
      </div>

      <div class="form-group">
        <label for="diary-content"><i class="fas fa-pen"></i> äº‹ä»¶ä¸æ„Ÿæƒ³:</label>
        <div id="diary-content" contenteditable="true" placeholder="å¼€å§‹å†™ä¸‹ä»Šå¤©çš„æ—¥è®°å§..."></div>
        <div class="entry-counter">å·²è¾“å…¥ <span id="word-count">0</span> å­—</div>
      </div>

      <div class="toolbar">
        <div class="toolbar-section">
          <span><i class="fas fa-icons"></i> è¡¨æƒ…:</span>
          <button onclick="toggleEmojiPicker()"><i class="far fa-smile"></i> é€‰æ‹©è¡¨æƒ…</button>
          <div id="emoji-picker" class="emoji-picker" style="display: none;">
            <span class="emoji" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span>
            <span class="emoji" onclick="insertEmoji('ğŸ¥°')">ğŸ¥°</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
            <span class="emoji" onclick="insertEmoji('ğŸ¤©')">ğŸ¤©</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜­')">ğŸ˜­</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜¡')">ğŸ˜¡</span>
            <span class="emoji" onclick="insertEmoji('ğŸ¤”')">ğŸ¤”</span>
            <span class="emoji" onclick="insertEmoji('ğŸ˜´')">ğŸ˜´</span>
            <span class="emoji" onclick="insertEmoji('â¤ï¸')">â¤ï¸</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‰')">ğŸ‰</span>
            <span class="emoji" onclick="insertEmoji('ğŸ‚')">ğŸ‚</span>
            <span class="emoji" onclick="insertEmoji('ğŸŒˆ')">ğŸŒˆ</span>
            <span class="emoji" onclick="insertEmoji('â­')">â­</span>
          </div>
        </div>

        <div class="toolbar-section">
          <span><i class="fas fa-image"></i> åª’ä½“:</span>
          <div class="file-input-wrapper">
            <button><i class="fas fa-image"></i> æ’å…¥å›¾ç‰‡</button>
            <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" />
          </div>
          <div class="file-input-wrapper">
            <button><i class="fas fa-music"></i> æ’å…¥éŸ³é¢‘</button>
            <input type="file" id="audioInput" accept="audio/*" onchange="insertAudio()" />
          </div>
        </div>
      </div>

      <div class="doodle-section">
        <label><i class="fas fa-paint-brush"></i> æ¶‚é¸¦:</label>
        <div class="doodle-tools">
          <div class="color-picker">
            <div class="color-option active" style="background-color: black;" data-color="black"></div>
            <div class="color-option" style="background-color: red;" data-color="red"></div>
            <div class="color-option" style="background-color: blue;" data-color="blue"></div>
            <div class="color-option" style="background-color: green;" data-color="green"></div>
            <div class="color-option" style="background-color: purple;" data-color="purple"></div>
          </div>
          <button onclick="changeBrushSize(-1)"><i class="fas fa-minus"></i></button>
          <span id="brush-size">2</span>
          <button onclick="changeBrushSize(1)"><i class="fas fa-plus"></i></button>
          <button onclick="clearCanvas()"><i class="fas fa-eraser"></i> æ¸…ç©º</button>
        </div>
        <canvas id="canvas" width="300" height="200"></canvas>
        <button class="btn btn-secondary" onclick="insertDoodle()" style="margin-top: 15px;">
          <i class="fas fa-plus-circle"></i> æ’å…¥æ¶‚é¸¦åˆ°æ—¥è®°
        </button>
      </div>

      <div class="actions">
        <button class="btn btn-secondary" onclick="clearAll()">
          <i class="fas fa-trash-alt"></i> æ¸…ç©ºæ—¥è®°
        </button>
        <button class="btn btn-primary" onclick="saveDiary()">
          <i class="fas fa-save"></i> ä¿å­˜æ—¥è®°
        </button>
      </div>
    </div>
  </div>

  <script>
    // åˆå§‹åŒ–æ—¶é—´å’Œå­—æ•°ç»Ÿè®¡
    window.onload = () => {
      const now = new Date();
      const local = now.toISOString().slice(0,16);
      document.getElementById("time").value = local;
      
      // å­—æ•°ç»Ÿè®¡
      const content = document.getElementById("diary-content");
      content.addEventListener('input', updateWordCount);
      updateWordCount();
    }

    function updateWordCount() {
      const content = document.getElementById("diary-content");
      const text = content.innerText || content.textContent;
      const wordCount = text.trim().length;
      document.getElementById("word-count").textContent = wordCount;
    }

    function insertEmoji(emoji) {
      const content = document.getElementById("diary-content");
      const selection = window.getSelection();
      
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        range.deleteContents();
        const emojiNode = document.createTextNode(emoji);
        range.insertNode(emojiNode);
        range.setStartAfter(emojiNode);
        range.setEndAfter(emojiNode);
        selection.removeAllRanges();
        selection.addRange(range);
      } else {
        content.innerHTML += emoji;
      }
      
      updateWordCount();
      content.focus();
    }

    function toggleEmojiPicker() {
      const picker = document.getElementById("emoji-picker");
      picker.style.display = picker.style.display === "none" ? "flex" : "none";
    }

    function insertImage() {
      const input = document.getElementById("imageInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        const selection = window.getSelection();
        
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          range.deleteContents();
          
          const img = document.createElement("img");
          img.src = e.target.result;
          img.className = "preview-img";
          
          range.insertNode(img);
          range.setStartAfter(img);
          range.setEndAfter(img);
          selection.removeAllRanges();
          selection.addRange(range);
        } else {
          content.innerHTML += `<br><img src="${e.target.result}" class="preview-img"><br>`;
        }
        
        content.focus();
      };
      reader.readAsDataURL(file);
      input.value = "";
    }

    function insertAudio() {
      const input = document.getElementById("audioInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        const selection = window.getSelection();
        
        if (selection.rangeCount > 0) {
          const range = selection.getRangeAt(0);
          range.deleteContents();
          
          const audio = document.createElement("audio");
          audio.controls = true;
          audio.className = "preview-audio";
          
          const source = document.createElement("source");
          source.src = e.target.result;
          source.type = file.type;
          audio.appendChild(source);
          
          range.insertNode(audio);
          range.setStartAfter(audio);
          range.setEndAfter(audio);
          selection.removeAllRanges();
          selection.addRange(range);
        } else {
          content.innerHTML += `<br><audio controls class="preview-audio"><source src="${e.target.result}" type="${file.type}"></audio><br>`;
        }
        
        content.focus();
      };
      reader.readAsDataURL(file);
      input.value = "";
    }

    // æ¶‚é¸¦åŠŸèƒ½
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let currentColor = "black";
    let brushSize = 2;

    // è®¾ç½®åˆå§‹ç”»ç¬”
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = brushSize;
    ctx.lineCap = "round";

    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseout", stopDrawing);
    canvas.addEventListener("mousemove", draw);

    function startDrawing(e) {
      drawing = true;
      draw(e);
    }

    function stopDrawing() {
      drawing = false;
      ctx.beginPath();
    }

    function draw(e) {
      if (!drawing) return;
      
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    }

    // é¢œè‰²é€‰æ‹©
    document.querySelectorAll('.color-option').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.color-option').forEach(opt => {
          opt.classList.remove('active');
        });
        this.classList.add('active');
        currentColor = this.getAttribute('data-color');
        ctx.strokeStyle = currentColor;
      });
    });

    // è°ƒæ•´ç”»ç¬”å¤§å°
    function changeBrushSize(delta) {
      brushSize += delta;
      if (brushSize < 1) brushSize = 1;
      if (brushSize > 10) brushSize = 10;
      document.getElementById('brush-size').textContent = brushSize;
      ctx.lineWidth = brushSize;
    }

    // æ¸…ç©ºç”»å¸ƒ
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function insertDoodle() {
      const content = document.getElementById("diary-content");
      const dataURL = canvas.toDataURL();
      
      const selection = window.getSelection();
      if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        range.deleteContents();
        
        const img = document.createElement("img");
        img.src = dataURL;
        img.className = "preview-img";
        
        range.insertNode(img);
        range.setStartAfter(img);
        range.setEndAfter(img);
        selection.removeAllRanges();
        selection.addRange(range);
      } else {
        content.innerHTML += `<br><img src="${dataURL}" class="preview-img"><br>`;
      }
      
      content.focus();
    }

    // ä¿å­˜æ—¥è®°
    function saveDiary() {
      const time = document.getElementById("time").value;
      const weather = document.getElementById("weather").value;
      const mood = document.getElementById("mood").value;
      const location = document.getElementById("location").value;
      const toWhom = document.getElementById("to-whom").value;
      const doWhat = document.getElementById("do-what").value;
      let content = document.getElementById("diary-content").innerHTML;
      
      // å¦‚æœå¡«å†™äº†å¿ƒæƒ…æ€»ç»“ï¼Œå°†å…¶æ·»åŠ åˆ°æ—¥è®°å†…å®¹çš„æœ€å‰é¢
      if (toWhom.trim() || doWhat.trim()) {
        const summaryHTML = `<div style="background: #fff9e6; padding: 15px; border-radius: 8px; border-left: 4px solid #ffa94d; margin-bottom: 15px;">
          <strong>âœ¨ ä»Šæ—¥å¿ƒæƒ…æ€»ç»“ï¼š</strong> æˆ‘ä»Šå¤©æƒ³å¯¹ <em>${toWhom || '___'}</em> <em>${doWhat || '___'}</em>
        </div>`;
        content = summaryHTML + content;
      }
      
      if (!content.trim()) {
        alert("æ—¥è®°å†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
        return;
      }
      
      const diaryEntry = {
        time,
        weather,
        mood,
        location,
        toWhom,
        doWhat,
        content,
        timestamp: new Date().toISOString()
      };
      
      // è¿™é‡Œå¯ä»¥æ·»åŠ ä¿å­˜é€»è¾‘ï¼Œå¦‚ä¿å­˜åˆ°localStorageæˆ–å‘é€åˆ°æœåŠ¡å™¨
      console.log("ä¿å­˜æ—¥è®°:", diaryEntry);
      alert("æ—¥è®°ä¿å­˜æˆåŠŸï¼");
    }

    // æ¸…ç©ºæ—¥è®°
    function clearAll() {
      if (confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
        document.getElementById("diary-content").innerHTML = "";
        document.getElementById("location").value = "";
        document.getElementById("to-whom").value = "";
        document.getElementById("do-what").value = "";
        clearCanvas();
        updateWordCount();
      }
    }
  </script>
</body>
</html>