<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¤šåª’ä½“æ—¥è®°</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background-color: #f7f9fc;
      transition: background-color 0.5s ease;
      background-image: linear-gradient(135deg, rgba(255,255,255,0.1) 25%, transparent 25%),
                        linear-gradient(225deg, rgba(255,255,255,0.1) 25%, transparent 25%),
                        linear-gradient(315deg, rgba(255,255,255,0.1) 25%, transparent 25%),
                        linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%);
      background-position: 10px 0, 10px 0, 0 0, 0 0;
      background-size: 20px 20px;
    }

    h1 {
      text-align: center;
      color: #5a5a5a;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      font-weight: 300;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .form-group {
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.4);
      transition: all 0.3s ease;
    }

    .form-group:hover {
      background: rgba(255, 255, 255, 0.6);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
      color: #444;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      background-color: rgba(255, 255, 255, 0.8);
      border: 1px solid #ddd;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #93B5C6;
      box-shadow: 0 0 0 3px rgba(147, 181, 198, 0.2);
    }

    #diary-content {
      min-height: 200px;
      border: 1px solid #ddd;
      padding: 15px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    #diary-content:focus {
      border-color: #93B5C6;
      box-shadow: 0 0 0 3px rgba(147, 181, 198, 0.2);
    }

    #canvas {
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: crosshair;
      background-color: white;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .toolbar label {
      margin: 0;
      margin-right: 10px;
    }

    .toolbar button {
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .toolbar button:hover {
      background: #e0e0e0;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      overflow: hidden;
      margin: 0 5px;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-input-button {
      display: inline-block;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .file-input-wrapper:hover .file-input-button {
      background: #e0e0e0;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .preview-img, .preview-audio {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .emoji {
      width: 30px;
      height: 30px;
      cursor: pointer;
      margin: 0 5px;
      transition: transform 0.2s ease;
    }

    .emoji:hover {
      transform: scale(1.2);
    }

    /* å¿ƒæƒ…åˆ†å¸ƒæ ·å¼ */
    #mood-calendar {
      margin-top: 30px;
      padding: 25px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      transition: background-color 0.5s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    #mood-calendar h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #5a5a5a;
      font-weight: 300;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day {
      text-align: center;
      padding: 12px 5px;
      border: 1px solid #eee;
      border-radius: 8px;
      min-height: 70px;
      background-color: rgba(250, 250, 250, 0.8);
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .calendar-day:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .calendar-day-header {
      font-weight: bold;
      background-color: rgba(147, 181, 198, 0.3);
      color: #444;
    }

    .day-number {
      font-size: 16px;
      margin-bottom: 8px;
      color: #666;
    }

    .day-mood {
      font-size: 24px;
      line-height: 1;
    }

    .other-month {
      background-color: rgba(240, 240, 240, 0.5);
      color: #aaa;
    }

    /* ä¿å­˜æŒ‰é’®æ ·å¼ */
    #save-btn {
      display: block;
      margin: 30px auto;
      padding: 14px 30px;
      background: linear-gradient(135deg, #93B5C6 0%, #76A5AF 100%);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 6px 20px rgba(118, 165, 175, 0.4);
      transition: all 0.3s ease;
    }

    #save-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(118, 165, 175, 0.6);
    }

    #save-btn:active {
      transform: translateY(1px);
    }

    /* èƒŒæ™¯é¢œè‰²é€‰æ‹©å™¨æ ·å¼ */
    #bg-color-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 25px 0;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      transition: background-color 0.5s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    #bg-color-selector-label {
      width: 100%;
      font-weight: bold;
      margin-bottom: 15px;
      color: #444;
    }

    .color-option {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }

    .color-option:hover {
      transform: scale(1.15);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .color-option.selected {
      border-color: #fff;
      box-shadow: 0 0 0 3px #333, 0 5px 15px rgba(0,0,0,0.2);
      transform: scale(1.15);
    }

    /* æ¶‚é¸¦å·¥å…·æ æ ·å¼ */
    .drawing-tools {
      display: flex;
      gap: 12px;
      margin-top: 15px;
      flex-wrap: wrap;
      align-items: center;
      padding: 15px;
      background: rgba(245, 245, 245, 0.7);
      border-radius: 10px;
    }

    .drawing-tools button {
      padding: 8px 16px;
      background-color: #e0e0e0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .drawing-tools button:hover {
      background-color: #d0d0d0;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .drawing-tools button.active {
      background: linear-gradient(135deg, #93B5C6 0%, #76A5AF 100%);
      color: white;
      box-shadow: 0 4px 10px rgba(118, 165, 175, 0.3);
    }

    .brush-size-container, .color-picker-container {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.7);
      padding: 8px 15px;
      border-radius: 6px;
    }

    .brush-size-container label, .color-picker-container label {
      margin: 0;
      font-size: 14px;
      color: #555;
    }

    .brush-size-container input {
      width: 100px;
      margin: 0;
    }

    .color-picker-container input {
      width: 50px;
      height: 35px;
      padding: 0;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    #brush-size-value {
      min-width: 20px;
      text-align: center;
      font-weight: bold;
      color: #555;
    }

    .section-title {
      font-size: 20px;
      margin-top: 30px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(147, 181, 198, 0.3);
      color: #5a5a5a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“˜ æˆ‘çš„å¤šåª’ä½“æ—¥è®°</h1>

    <!-- èƒŒæ™¯é¢œè‰²é€‰æ‹©å™¨ -->
    <div id="bg-color-selector">
      <div id="bg-color-selector-label">ğŸ¨ é€‰æ‹©èƒŒæ™¯é¢œè‰²ï¼š</div>
      <!-- é¢œè‰²é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <div class="form-group">
      <label for="time">â° æ—¶é—´:</label>
      <input type="datetime-local" id="time">
    </div>

    <div class="form-group">
      <label for="weather">ğŸŒ¤ï¸ å¤©æ°”:</label>
      <select id="weather">
        <option value="â˜€ï¸ æ™´">â˜€ï¸ æ™´</option>
        <option value="â›… å¤šäº‘">â›… å¤šäº‘</option>
        <option value="ğŸŒ§ï¸ é›¨">ğŸŒ§ï¸ é›¨</option>
        <option value="ğŸŒ¨ï¸ é›ª">ğŸŒ¨ï¸ é›ª</option>
      </select>
    </div>

    <div class="form-group">
      <label for="mood">ğŸ˜Š å¿ƒæƒ…:</label>
      <select id="mood">
        <option value="ğŸ˜Š å¼€å¿ƒ">ğŸ˜Š å¼€å¿ƒ</option>
        <option value="ğŸ˜” éš¾è¿‡">ğŸ˜” éš¾è¿‡</option>
        <option value="ğŸ˜  ç”Ÿæ°”">ğŸ˜  ç”Ÿæ°”</option>
        <option value="ğŸ˜Œ å¹³é™">ğŸ˜Œ å¹³é™</option>
      </select>
    </div>

    <div class="form-group">
      <label for="location">ğŸ“ åœ°ç‚¹:</label>
      <input type="text" id="location" placeholder="è¯·è¾“å…¥åœ°ç‚¹">
    </div>

    <div class="form-group">
      <label for="diary-content">ğŸ“ äº‹ä»¶ä¸æ„Ÿæƒ³:</label>
      <div id="diary-content" contenteditable="true"></div>
    </div>

    <div class="form-group toolbar">
      <label>ğŸ“ æ’å…¥ï¼š</label>
      <button onclick="insertEmoji('ğŸ˜Š')" title="å¼€å¿ƒ"><span class="emoji">ğŸ˜Š</span></button>
      <button onclick="insertEmoji('ğŸ˜¢')" title="éš¾è¿‡"><span class="emoji">ğŸ˜¢</span></button>
      <button onclick="insertEmoji('â¤ï¸')" title="çˆ±å¿ƒ"><span class="emoji">â¤ï¸</span></button>
      
      <div class="file-input-wrapper">
        <div class="file-input-button">ğŸ–¼ï¸ å›¾ç‰‡</div>
        <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" />
      </div>
      
      <div class="file-input-wrapper">
        <div class="file-input-button">ğŸµ éŸ³é¢‘</div>
        <input type="file" id="audioInput" accept="audio/*" onchange="insertAudio()" />
      </div>
    </div>

    <h3 class="section-title">ğŸ¨ æ¶‚é¸¦åˆ›ä½œ</h3>
    <div class="form-group">
      <label>ğŸ–Œï¸ æ¶‚é¸¦ï¼ˆç‚¹å‡»åä¿å­˜æ’å…¥ï¼‰:</label><br>
      <canvas id="canvas" width="100%" height="250"></canvas><br>
      <div class="drawing-tools">
        <button id="pen-tool" class="active">âœï¸ ç”»ç¬”</button>
        <button id="eraser-tool">ğŸ§¹ æ©¡çš®æ“¦</button>
        
        <div class="brush-size-container">
          <label>ğŸ“ å¤§å°:</label>
          <input type="range" id="brush-size" min="1" max="30" value="3">
          <span id="brush-size-value">3</span>
        </div>
        
        <div class="color-picker-container">
          <label>ğŸ¨ é¢œè‰²:</label>
          <input type="color" id="brush-color" value="#000000">
        </div>
        
        <button id="clear-canvas">ğŸ—‘ï¸ æ¸…ç©º</button>
      </div>
      <button onclick="insertDoodle()" style="margin-top: 15px; padding: 10px 20px;">ğŸ’¾ æ’å…¥æ¶‚é¸¦</button>
    </div>

    <button id="save-btn">ğŸ’¾ ä¿å­˜æ—¥è®°</button>
  </div>

  <!-- å¿ƒæƒ…åˆ†å¸ƒåŒºåŸŸ -->
  <div id="mood-calendar">
    <h2>ğŸ“… å¿ƒæƒ…æ—¥å†</h2>
    <div class="calendar-grid" id="calendar-container">
      <!-- æ—¥å†å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
  </div>

  <script>
    // è«å…°è¿ªè‰²ç³»è°ƒè‰²æ¿
    const morandiColors = [
      '#FFB6B9', // äº®ç²‰è‰²
      '#FAE3D9', // è‚¤è‰²
      '#BBDED6', // è–„è·ç»¿
      '#93B5C6', // è“è‰²
      '#FFD1DC', // æ·¡ç²‰è‰²
      '#F5E6CA', // ç±³é»„è‰²
      '#E8F1F2', // æ·¡ç°è“
      '#F4F1E6'  // ç±³ç™½è‰²
    ];

    // åˆå§‹åŒ–èƒŒæ™¯é¢œè‰²é€‰æ‹©å™¨
    function initBgColorSelector() {
      const selector = document.getElementById('bg-color-selector');
      const label = document.getElementById('bg-color-selector-label');
      
      // ä¸ºæ¯ä¸ªé¢œè‰²åˆ›å»ºé€‰é¡¹
      morandiColors.forEach((color, index) => {
        const colorOption = document.createElement('div');
        colorOption.className = 'color-option';
        colorOption.style.backgroundColor = color;
        colorOption.dataset.color = color;
        
        // è®¾ç½®ç¬¬ä¸€ä¸ªé¢œè‰²ä¸ºé»˜è®¤é€‰ä¸­
        if (index === 0) {
          colorOption.classList.add('selected');
          changeBackgroundColor(color);
        }
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        colorOption.addEventListener('click', function() {
          // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('.color-option').forEach(option => {
            option.classList.remove('selected');
          });
          
          // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
          this.classList.add('selected');
          
          // æ›´æ”¹èƒŒæ™¯é¢œè‰²
          changeBackgroundColor(color);
        });
        
        selector.appendChild(colorOption);
      });
      
      // ä»localStorageæ¢å¤ä¹‹å‰é€‰æ‹©çš„é¢œè‰²
      const savedColor = localStorage.getItem('diaryBgColor');
      if (savedColor) {
        changeBackgroundColor(savedColor);
        document.querySelectorAll('.color-option').forEach(option => {
          option.classList.remove('selected');
          if (option.dataset.color === savedColor) {
            option.classList.add('selected');
          }
        });
      }
    }

    // æ›´æ”¹èƒŒæ™¯é¢œè‰²å¹¶ç›¸åº”è°ƒæ•´è¾“å…¥æ¡†é€æ˜åº¦
    function changeBackgroundColor(color) {
      // è®¾ç½®é¡µé¢èƒŒæ™¯è‰²
      document.body.style.backgroundColor = color;
      
      // ä¿å­˜é€‰æ‹©åˆ°localStorage
      localStorage.setItem('diaryBgColor', color);
    }

    // åŸæœ‰å‡½æ•°ä¿æŒä¸å˜
    function insertEmoji(emoji) {
      const content = document.getElementById("diary-content");
      content.innerHTML += emoji;
    }

    function insertImage() {
      const input = document.getElementById("imageInput");
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><img src="${e.target.result}" class="preview-img"><br>`;
      };
      reader.readAsDataURL(file);
    }

    function insertAudio() {
      const input = document.getElementById("audioInput");
      const file = input.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><audio controls class="preview-audio"><source src="${e.target.result}" type="${file.type}"></audio><br>`;
      };
      reader.readAsDataURL(file);
    }

    // å®Œå–„çš„æ¶‚é¸¦åŠŸèƒ½
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let currentTool = 'pen'; // 'pen' or 'eraser'
    let brushSize = 3;
    let brushColor = '#000000';
    let canvasBgColor = 'white';

    // è®¾ç½®canvasåˆå§‹çŠ¶æ€
    function initCanvas() {
      ctx.fillStyle = canvasBgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = brushColor;
      ctx.lineWidth = brushSize;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";
    }

    // ç»˜åˆ¶å‡½æ•°
    function draw(e) {
      if (!isDrawing) return;
      
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      if (currentTool === 'pen') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = brushColor;
      } else if (currentTool === 'eraser') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = canvasBgColor;
      }
      
      ctx.lineWidth = brushSize;
      
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      
      lastX = x;
      lastY = y;
    }

    // é¼ æ ‡äº‹ä»¶
    canvas.addEventListener("mousedown", function(e) {
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
    });
    
    canvas.addEventListener("mousemove", draw);
    canvas.addEventListener("mouseup", () => isDrawing = false);
    canvas.addEventListener("mouseout", () => isDrawing = false);

    // è§¦æ‘¸äº‹ä»¶æ”¯æŒç§»åŠ¨è®¾å¤‡
    canvas.addEventListener("touchstart", function(e) {
      e.preventDefault();
      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.touches[0].clientX - rect.left;
      lastY = e.touches[0].clientY - rect.top;
    });
    
    canvas.addEventListener("touchmove", function(e) {
      e.preventDefault();
      if (!isDrawing) return;
      
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      
      if (currentTool === 'pen') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = brushColor;
      } else if (currentTool === 'eraser') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.strokeStyle = canvasBgColor;
      }
      
      ctx.lineWidth = brushSize;
      
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      
      lastX = x;
      lastY = y;
    });
    
    canvas.addEventListener("touchend", () => isDrawing = false);

    // å·¥å…·é€‰æ‹©
    document.getElementById("pen-tool").addEventListener("click", function() {
      currentTool = 'pen';
      this.classList.add('active');
      document.getElementById("eraser-tool").classList.remove('active');
      ctx.globalCompositeOperation = 'source-over';
      ctx.strokeStyle = brushColor;
    });
    
    document.getElementById("eraser-tool").addEventListener("click", function() {
      currentTool = 'eraser';
      this.classList.add('active');
      document.getElementById("pen-tool").classList.remove('active');
      ctx.globalCompositeOperation = 'source-over';
      ctx.strokeStyle = canvasBgColor;
    });

    // ç¬”åˆ·å¤§å°æ§åˆ¶
    const brushSizeSlider = document.getElementById("brush-size");
    const brushSizeValue = document.getElementById("brush-size-value");
    
    brushSizeSlider.addEventListener("input", function() {
      brushSize = parseInt(this.value);
      brushSizeValue.textContent = brushSize;
      ctx.lineWidth = brushSize;
    });

    // ç¬”åˆ·é¢œè‰²æ§åˆ¶
    const brushColorPicker = document.getElementById("brush-color");
    
    brushColorPicker.addEventListener("input", function() {
      brushColor = this.value;
      if (currentTool === 'pen') {
        ctx.strokeStyle = brushColor;
      }
    });

    // æ¸…ç©ºç”»å¸ƒ
    document.getElementById("clear-canvas").addEventListener("click", function() {
      if (confirm("ç¡®å®šè¦æ¸…ç©ºç”»å¸ƒå—ï¼Ÿ")) {
        initCanvas();
      }
    });

    function insertDoodle() {
      const content = document.getElementById("diary-content");
      const dataURL = canvas.toDataURL();
      content.innerHTML += `<br><img src="${dataURL}" class="preview-img"><br>`;
    }

    // åˆå§‹åŒ–æ—¶é—´ä¸ºå½“å‰
    window.onload = () => {
      const now = new Date();
      const local = now.toISOString().slice(0,16);
      document.getElementById("time").value = local;
      
      // åˆå§‹åŒ–èƒŒæ™¯é¢œè‰²é€‰æ‹©å™¨
      initBgColorSelector();
      
      // åˆå§‹åŒ–ç”»å¸ƒ
      initCanvas();
      
      // åˆå§‹åŒ–å¿ƒæƒ…æ—¥å†
      generateMoodCalendar();
    };

    // ä¿å­˜æ—¥è®°æ¡ç›®
    function saveDiaryEntry() {
      const time = document.getElementById("time").value;
      const weather = document.getElementById("weather").value;
      const mood = document.getElementById("mood").value;
      const location = document.getElementById("location").value;
      const content = document.getElementById("diary-content").innerHTML;
      
      if (!time) {
        alert("è¯·é€‰æ‹©æ—¶é—´");
        return;
      }
      
      // åˆ›å»ºæ—¥è®°æ¡ç›®å¯¹è±¡
      const diaryEntry = {
        time,
        weather,
        mood,
        location,
        content
      };
      
      // ä»localStorageè·å–ç°æœ‰æ—¥è®°æ•°æ®
      let diaryData = JSON.parse(localStorage.getItem("diaryEntries") || "{}");
      
      // ä½¿ç”¨æ—¥æœŸä½œä¸ºé”®ä¿å­˜æ—¥è®°
      const dateKey = time.split("T")[0]; // è·å– YYYY-MM-DD æ ¼å¼çš„æ—¥æœŸ
      diaryData[dateKey] = diaryEntry;
      
      // ä¿å­˜åˆ°localStorage
      localStorage.setItem("diaryEntries", JSON.stringify(diaryData));
      
      // é‡æ–°ç”Ÿæˆå¿ƒæƒ…æ—¥å†
      generateMoodCalendar();
      
      alert("æ—¥è®°ä¿å­˜æˆåŠŸï¼");
    }

    // ç”Ÿæˆå¿ƒæƒ…æ—¥å†
    function generateMoodCalendar() {
      const calendarContainer = document.getElementById("calendar-container");
      calendarContainer.innerHTML = ""; // æ¸…ç©ºå®¹å™¨
      
      // åˆ›å»ºæ˜ŸæœŸæ ‡é¢˜
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      weekdays.forEach(day => {
        const dayHeader = document.createElement("div");
        dayHeader.className = "calendar-day calendar-day-header";
        dayHeader.textContent = day;
        calendarContainer.appendChild(dayHeader);
      });
      
      // è·å–å½“å‰æœˆä»½ä¿¡æ¯
      const today = new Date();
      const year = today.getFullYear();
      const month = today.getMonth();
      
      // è·å–æœ¬æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      // è·å–æœ¬æœˆæ€»å¤©æ•°
      const daysInMonth = lastDay.getDate();
      
      // è®¡ç®—ç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ ï¼ˆ0=æ˜ŸæœŸæ—¥, 6=æ˜ŸæœŸå…­ï¼‰
      const firstDayOfWeek = firstDay.getDay();
      
      // æ·»åŠ ç©ºç™½æ ¼å­ä»¥å¯¹é½æ˜ŸæœŸ
      for (let i = 0; i < firstDayOfWeek; i++) {
        const emptyDay = document.createElement("div");
        emptyDay.className = "calendar-day";
        calendarContainer.appendChild(emptyDay);
      }
      
      // ä»localStorageè·å–æ—¥è®°æ•°æ®
      const diaryData = JSON.parse(localStorage.getItem("diaryEntries") || "{}");
      
      // ä¸ºæœ¬æœˆæ¯ä¸€å¤©åˆ›å»ºæ ¼å­
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement("div");
        dayElement.className = "calendar-day";
        
        // æ·»åŠ æ—¥æœŸæ•°å­—
        const dayNumber = document.createElement("div");
        dayNumber.className = "day-number";
        dayNumber.textContent = day;
        dayElement.appendChild(dayNumber);
        
        // æ·»åŠ å¿ƒæƒ…ç¬¦å·
        const dayMood = document.createElement("div");
        dayMood.className = "day-mood";
        
        // æ„é€ æ—¥æœŸé”® (YYYY-MM-DD)
        const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        
        // å¦‚æœæœ‰å¯¹åº”çš„æ—¥è®°æ¡ç›®ï¼Œæ˜¾ç¤ºå¿ƒæƒ…
        if (diaryData[dateKey]) {
          // æå–å¿ƒæƒ…ç¬¦å·ï¼ˆä»é€‰é¡¹æ–‡æœ¬ä¸­è·å–ç¬¬ä¸€ä¸ªè¡¨æƒ…ç¬¦å·ï¼‰
          const moodText = diaryData[dateKey].mood;
          const moodEmoji = moodText.substring(0, 2); // è·å–è¡¨æƒ…ç¬¦å·éƒ¨åˆ†
          dayMood.textContent = moodEmoji;
        }
        
        dayElement.appendChild(dayMood);
        calendarContainer.appendChild(dayElement);
      }
    }
    
    // å“åº”å¼ç”»å¸ƒ
    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      initCanvas();
    }
    
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
  </script>
</body>
</html>