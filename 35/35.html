<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šåª’ä½“æ—¥è®°</title>
  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #6b8cb7;
      --light-color: #f7f9fc;
      --dark-color: #333;
      --border-color: #e9ecef;
      --radius: 8px;
      --shadow-light: 0 2px 8px rgba(0,0,0,0.05);
      --shadow-hover: 0 4px 12px rgba(0,0,0,0.1);
      --radius-small: 4px;
      --radius-button: 6px;
      --spacing-xs: 8px;
      --spacing-sm: 12px;
      --spacing-md: 16px;
      --spacing-lg: 20px;
      --spacing-xl: 25px;
      --transition-base: all 0.2s ease;
      --transition-slow: all 0.3s ease;
      --header-height: 56px;
      --font-size-sm: 14px;
      --font-size-base: 16px;
      --font-size-lg: 18px;
      
      /* å¿ƒæƒ…å¯¹åº”çš„èƒŒæ™¯é¢œè‰² */
      --mood-happy: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      --mood-sad: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      --mood-angry: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      --mood-calm: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      --mood-surprised: linear-gradient(135deg, #fff8e1 0%, #ffe082 100%);
      --mood-love: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
      --mood-tired: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
      --default-background: #f7f9fc;
    }
    
    body {
      margin: 0;
      padding: var(--spacing-xl) var(--spacing-lg);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      color: var(--dark-color);
      background: var(--default-background);
      transition: background var(--transition-slow);
      min-height: 100vh;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      padding: var(--spacing-lg);
      background-color: var(--light-color);
      color: var(--dark-color);
      line-height: 1.6;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: var(--spacing-xl);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: var(--spacing-xl);
      font-weight: 600;
      font-size: 28px;
    }

    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    label {
      display: block;
      font-weight: 500;
      margin-bottom: var(--spacing-xs);
      color: #555;
      font-size: var(--font-size-sm);
    }
    
    /* å…ƒä¿¡æ¯åŒºåŸŸæ ·å¼ */
    .meta-info-container {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4eaf2 100%);
      border-radius: var(--radius);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      border: 1px solid #e9ecef;
      box-shadow: var(--shadow-light);
    }
    
    .meta-info-container h3 {
      color: var(--primary-color);
      margin: 0 0 var(--spacing-md) 0;
      font-size: var(--font-size-lg);
      font-weight: 600;
      text-align: center;
      position: relative;
    }
    
    .meta-info-container h3::after {
      content: '';
      display: block;
      width: 50px;
      height: 3px;
      background: var(--secondary-color);
      margin: var(--spacing-xs) auto 0;
      border-radius: var(--radius-small);
    }
    
    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
    }
    
    .meta-item {
      display: flex;
      align-items: stretch;
      background: white;
      border-radius: var(--radius-small);
      overflow: hidden;
      border: 1px solid #e9ecef;
      transition: var(--transition-slow);
    }
    
    .meta-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      border-color: var(--secondary-color);
    }
    
    .meta-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      font-size: 24px;
      background: var(--light-color);
      color: var(--primary-color);
      border-right: 1px solid #e9ecef;
    }
    
    .meta-content {
      flex: 1;
      padding: var(--spacing-sm) var(--spacing-md);
      display: flex;
      flex-direction: column;
    }
    
    .meta-content label {
      margin: 0 0 var(--spacing-xs) 0;
      font-size: var(--font-size-sm);
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .meta-input {
      border: none;
      background: transparent;
      padding: var(--spacing-xs) 0;
      font-size: var(--font-size-base);
      color: var(--dark-color);
      margin: 0;
    }
    
    .meta-input:focus {
      outline: none;
      box-shadow: none;
      border-color: transparent;
    }
    
    /* æŒ‰é’®æ ·å¼ç»Ÿä¸€ */
    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: var(--radius-button);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: var(--transition-base);
      font-weight: 500;
    }
    
    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    /* ç‰¹å®šé¡¹çš„é¢œè‰²ä¸»é¢˜ */
    .time-item .meta-icon {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .location-item .meta-icon {
      background: #e8f5e9;
      color: #388e3c;
    }
    
    .weather-item .meta-icon {
      background: #fff3e0;
      color: #f57c00;
    }
    
    .mood-item .meta-icon {
      background: #f3e5f5;
      color: #7b1fa2;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 600px) {
      .meta-grid {
        grid-template-columns: 1fr;
      }
      
      .meta-icon {
        width: 45px;
        font-size: 20px;
      }
      
      .meta-content {
        padding: 10px 12px;
      }
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      margin-top: 5px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 16px;
      transition: border 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 2px rgba(107, 140, 183, 0.2);
    }

    /* äº‹ä»¶ä¸æ„Ÿæƒ³åŒºåŸŸæ ·å¼ */
    .content-section {
      margin-bottom: var(--spacing-xl);
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-light);
      border: 1px solid #e9ecef;
    }
    
    .section-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      color: white;
      padding: var(--spacing-md) var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: var(--header-height);
    }
    
    .section-header h3 {
      margin: 0;
      font-size: var(--font-size-lg);
      font-weight: 600;
    }
    
    .char-count {
      font-size: var(--font-size-sm);
      opacity: 0.9;
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 12px;
      transition: var(--transition-base);
    }
    
    /* æ–‡æœ¬å·¥å…·æ æ ·å¼ */
    .text-toolbar {
      background: #f8f9fa;
      padding: var(--spacing-sm) var(--spacing-md);
      border-bottom: 1px solid #e9ecef;
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-md);
      align-items: center;
    }
    
    .toolbar-group {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }
    
    .toolbar-group label {
      margin: 0;
      font-size: var(--font-size-sm);
      color: #666;
      font-weight: 500;
    }
    
    .format-btn {
      background: white;
      color: #333;
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ddd;
      border-radius: var(--radius-button);
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition-base);
      flex-shrink: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .format-btn.list-btn {
      font-size: 18px;
      font-weight: bold;
    }
    
    .format-btn:hover {
      background: #f0f4f8;
      border-color: var(--secondary-color);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .emoji-btn {
      background: white;
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #ddd;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition-base);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .emoji-btn:hover {
      background: #f9f9f9;
      transform: scale(1.1);
      border-color: var(--secondary-color);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* æ–‡ä»¶ä¸Šä¼ æ ‡ç­¾æ ·å¼ */
    .file-label {
      background: white;
      color: var(--primary-color);
      padding: 6px 12px;
      border: 1px solid var(--secondary-color);
      border-radius: var(--radius-button);
      cursor: pointer;
      font-size: var(--font-size-sm);
      transition: var(--transition-base);
      display: inline-block;
      font-weight: 500;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .file-label:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .file-label input[type="file"] {
      display: none;
    }
    
    /* ç¼–è¾‘å™¨å®¹å™¨æ ·å¼ */
    .editor-container {
      position: relative;
    }
    
    #diary-content {
      min-height: 250px;
      border: none;
      padding: var(--spacing-lg);
      background-color: white;
      font-size: var(--font-size-base);
      line-height: 1.6;
      outline: none;
      transition: background-color var(--transition-base);
      width: 100%;
      resize: vertical;
    }
    
    #diary-content:focus {
      background-color: #fafbfc;
    }
    
    .editor-placeholder {
      position: absolute;
      top: var(--spacing-lg);
      left: var(--spacing-lg);
      color: #999;
      pointer-events: none;
      font-style: italic;
      font-size: var(--font-size-base);
    }

    #canvas {
      border: 1px solid var(--border-color);
      cursor: crosshair;
      border-radius: 4px;
      background: white;
    }

    .toolbar {
      background: #f5f7fa;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .toolbar label {
      margin: 0;
      font-weight: 500;
    }

    .toolbar-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    .preview-img, .preview-audio {
      max-width: 100%;
      margin: 15px 0;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .emoji {
      width: 24px;
      height: 24px;
      cursor: pointer;
      vertical-align: middle;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .color-picker {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      margin-bottom: 0;
    }

    .color-option {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #ccc;
      transition: var(--transition-base);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    
    .color-option:hover {
      transform: scale(1.1);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .color-option.active {
      border: 2px solid var(--primary-color);
      box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.3);
      transform: scale(1.1);
    }
    
    .custom-color {
      width: 24px;
      height: 24px;
      border: 2px solid #ccc;
      border-radius: var(--radius-button);
      cursor: pointer;
      padding: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .brush-size {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      margin-bottom: 0;
    }
    
    .brush-size select {
      width: auto;
      min-width: 80px;
    }
    
    /* æ¶‚é¸¦å·¥å…·æ æ ·å¼ */
    .doodle-toolbar {
      background: #f8f9fa;
      padding: var(--spacing-md);
      border-radius: var(--radius);
      margin-bottom: var(--spacing-md);
      border: 1px solid #e9ecef;
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-lg);
      align-items: center;
      box-shadow: var(--shadow-light);
    }
    
    .toolbar-section {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .toolbar-section.buttons {
      margin-left: auto;
    }
    
    /* ç”»å¸ƒå®¹å™¨æ ·å¼ */
    .canvas-container {
      position: relative;
      margin-bottom: var(--spacing-lg);
      border: 1px solid #e9ecef;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-light);
    }
    
    .canvas-tip {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #999;
      font-size: var(--font-size-sm);
      pointer-events: none;
      opacity: 0.5;
      text-align: center;
    }
    
    #canvas {
      display: block;
      width: 100%;
      min-height: 300px;
      margin: 0 auto;
      border: none;
      background: white;
      transition: var(--transition-base);
    }
    
    #canvas:hover {
      background-color: #fafbfc;
    }
    
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 600px) {
      .doodle-toolbar {
        flex-direction: column;
        align-items: stretch;
      }
      
      .toolbar-section {
        justify-content: center;
      }
      
      .toolbar-section.buttons {
        margin-left: 0;
        justify-content: space-between;
      }
    }

    .diary-list {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .diary-entry {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .diary-entry:hover {
      background: #f0f4f8;
      transform: translateX(3px);
    }

    .diary-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 14px;
      color: #666;
    }

    .diary-preview {
      font-size: 14px;
      color: #555;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .empty-state {
      color: #999;
      text-align: center;
      padding: 20px;
      font-style: italic;
    }

    .clear-canvas {
      background-color: #e74c3c;
      margin-left: var(--spacing-sm);
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .clear-canvas:hover {
      background-color: #c0392b;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .insert-btn {
      background-color: #2ecc71;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .insert-btn:hover {
      background-color: #27ae60;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .save-btn {
      background-color: #3498db;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .save-btn:hover {
      background-color: #2980b9;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .delete-btn {
      background-color: #e74c3c;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .delete-btn:hover {
      background-color: #c0392b;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    @media (max-width: 600px) {
      .container {
        padding: 15px;
      }
      
      .toolbar {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .controls {
        flex-direction: column;
        gap: 10px;
      }
      
      .controls button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>æˆ‘çš„å¤šåª’ä½“æ—¥è®°</h1>

    <!-- ç´§å‡‘çš„å…ƒä¿¡æ¯åŒºåŸŸ -->
    <div class="meta-info-container">
      <h3>æ—¥è®°ä¿¡æ¯</h3>
      
      <div class="meta-grid">
        <div class="meta-item time-item">
          <div class="meta-icon">ğŸ“…</div>
          <div class="meta-content">
            <label>æ—¶é—´</label>
            <input type="datetime-local" id="time" class="meta-input">
          </div>
        </div>
        
        <div class="meta-item location-item">
          <div class="meta-icon">ğŸ“</div>
          <div class="meta-content">
            <label>åœ°ç‚¹</label>
            <input type="text" id="location" placeholder="è¯·è¾“å…¥åœ°ç‚¹" class="meta-input">
          </div>
        </div>
        
        <div class="meta-item weather-item">
          <div class="meta-icon">â˜€ï¸</div>
          <div class="meta-content">
            <label>å¤©æ°”</label>
            <select id="weather" class="meta-input" onchange="updateWeatherIcon(this.value)">
              <option>â˜€ï¸ æ™´</option>
              <option>â›… å¤šäº‘</option>
              <option>ğŸŒ§ï¸ é›¨</option>
              <option>ğŸŒ¨ï¸ é›ª</option>
              <option>ğŸŒ©ï¸ é›·é˜µé›¨</option>
              <option>ğŸŒ«ï¸ é›¾</option>
            </select>
          </div>
        </div>
        
        <div class="meta-item mood-item">
          <div class="meta-icon">ğŸ˜Š</div>
          <div class="meta-content">
            <label>å¿ƒæƒ…</label>
            <select id="mood" class="meta-input" onchange="changeBackgroundByMood(this.value)">
              <option>ğŸ˜Š å¼€å¿ƒ</option>
              <option>ğŸ˜” éš¾è¿‡</option>
              <option>ğŸ˜  ç”Ÿæ°”</option>
              <option>ğŸ˜Œ å¹³é™</option>
              <option>ğŸ˜² æƒŠè®¶</option>
              <option>ğŸ˜ çˆ±æ…•</option>
              <option>ğŸ˜´ ç–²æƒ«</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- äº‹ä»¶ä¸æ„Ÿæƒ³åŒºåŸŸ -->
    <div class="content-section">
      <div class="section-header">
        <h3>ğŸ“ äº‹ä»¶ä¸æ„Ÿæƒ³</h3>
        <span class="char-count" id="charCount">0 å­—ç¬¦</span>
      </div>
      
      <!-- æ–‡æœ¬ç¼–è¾‘å·¥å…·æ  -->
      <div class="text-toolbar">
        <div class="toolbar-group text-formatting">
          <label>æ–‡æœ¬æ ¼å¼ï¼š</label>
          <button class="format-btn" onclick="formatText('bold')" title="åŠ ç²—"><strong>B</strong></button>
          <button class="format-btn" onclick="formatText('italic')" title="æ–œä½“"><em>I</em></button>
          <button class="format-btn" onclick="formatText('underline')" title="ä¸‹åˆ’çº¿"><u>U</u></button>
          <button class="format-btn list-btn" onclick="formatText('insertUnorderedList')" title="æ— åºåˆ—è¡¨">â€¢</button>
        </div>
        
        <div class="toolbar-group emojis">
          <label>è¡¨æƒ…ï¼š</label>
          <button class="emoji-btn" onclick="insertEmoji('ğŸ˜Š')" title="å¼€å¿ƒ">ğŸ˜Š</button>
          <button class="emoji-btn" onclick="insertEmoji('ğŸ˜¢')" title="éš¾è¿‡">ğŸ˜¢</button>
          <button class="emoji-btn" onclick="insertEmoji('â¤ï¸')" title="çˆ±å¿ƒ">â¤ï¸</button>
          <button class="emoji-btn" onclick="insertEmoji('ğŸ‰')" title="åº†ç¥">ğŸ‰</button>
          <button class="emoji-btn" onclick="insertEmoji('ğŸ‘')" title="ç‚¹èµ">ğŸ‘</button>
        </div>
        
        <div class="toolbar-group media-insert">
          <label>æ’å…¥ï¼š</label>
          <label class="file-label">
            <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" />
            ğŸ“· å›¾ç‰‡
          </label>
          <label class="file-label">
            <input type="file" id="audioInput" accept="audio/*" onchange="insertAudio()" />
            ğŸµ éŸ³é¢‘
          </label>
        </div>
      </div>
      
      <!-- æ–‡æœ¬ç¼–è¾‘åŒºåŸŸ -->
      <div class="editor-container">
        <div id="diary-content" contenteditable="true" placeholder="å¼€å§‹è®°å½•ä½ çš„äº‹ä»¶å’Œæ„Ÿæƒ³..."></div>
        <div class="editor-placeholder" id="editorPlaceholder">å¼€å§‹è®°å½•ä½ çš„äº‹ä»¶å’Œæ„Ÿæƒ³...</div>
      </div>
    </div>

    <div class="form-group">
      <label>æ¶‚é¸¦ï¼ˆç‚¹å‡»åä¿å­˜æ’å…¥ï¼‰:</label>
      
      <!-- æ•´åˆå·¥å…·æ  -->
      <div class="doodle-toolbar">
        <div class="toolbar-section">
          <div class="color-picker">
            <label>é¢œè‰²ï¼š</label>
            <div class="color-option active" style="background: black;" onclick="setBrushColor('black')"></div>
            <div class="color-option" style="background: red;" onclick="setBrushColor('red')"></div>
            <div class="color-option" style="background: blue;" onclick="setBrushColor('blue')"></div>
            <div class="color-option" style="background: green;" onclick="setBrushColor('green')"></div>
            <div class="color-option" style="background: yellow;" onclick="setBrushColor('yellow')"></div>
            <!-- æ·»åŠ è‡ªå®šä¹‰é¢œè‰²é€‰æ‹© -->
            <input type="color" id="customColor" value="#000000" onchange="setCustomColor(this.value)" class="custom-color">
          </div>
        </div>
        
        <div class="toolbar-section">
          <div class="brush-size">
            <label>ç”»ç¬”å¤§å°ï¼š</label>
            <select id="brushSize" onchange="setBrushSize(this.value)">
              <option value="2">å°</option>
              <option value="5" selected>ä¸­</option>
              <option value="10">å¤§</option>
            </select>
          </div>
        </div>
        
        <div class="toolbar-section buttons">
          <button class="clear-canvas" onclick="clearCanvas()">æ¸…ç©ºç”»å¸ƒ</button>
          <button class="insert-btn" onclick="insertDoodle()">æ’å…¥æ¶‚é¸¦åˆ°æ—¥è®°</button>
        </div>
      </div>
      
      <!-- ç”»å¸ƒå®¹å™¨ -->
      <div class="canvas-container">
        <canvas id="canvas" title="ä½¿ç”¨é¼ æ ‡æˆ–è§¦æ‘¸å±åœ¨ç”»å¸ƒä¸Šæ¶‚é¸¦"></canvas>
        <div class="canvas-tip">ä½¿ç”¨é¼ æ ‡æˆ–è§¦æ‘¸å±åœ¨ç”»å¸ƒä¸Šæ¶‚é¸¦</div>
      </div>
    </div>

    <div class="controls">
      <button class="save-btn" onclick="saveDiary()">ä¿å­˜æ—¥è®°</button>
      <button class="delete-btn" onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
    </div>

    <div class="diary-list">
      <h3>æˆ‘çš„æ—¥è®°åˆ—è¡¨</h3>
      <div id="diaryEntries">
        <!-- æ—¥è®°åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let currentColor = 'black';
    let currentSize = 5;
    let currentDiaryId = null;

    // åˆå§‹åŒ–ç”»å¸ƒ
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    
    // è®¾ç½®ç”»å¸ƒå°ºå¯¸ä¸ºå“åº”å¼
    function resizeCanvas() {
      const container = document.querySelector('.container');
      const containerWidth = container.clientWidth - 60; // å‡å»æ›´å¤šè¾¹è·ï¼Œä¸ä¸Šæ–¹è¾“å…¥æ¡†å¯¹é½
      canvas.width = Math.min(containerWidth, 800); // æœ€å¤§å®½åº¦800px
      canvas.height = 300;
    }
    
    // é¡µé¢åŠ è½½æ—¶è°ƒæ•´ç”»å¸ƒå°ºå¯¸
    resizeCanvas();
    // çª—å£è°ƒæ•´å¤§å°æ—¶é‡æ–°è°ƒæ•´ç”»å¸ƒå°ºå¯¸
    window.addEventListener('resize', resizeCanvas);

    // æ–‡æœ¬æ ¼å¼åŒ–
    function formatText(command) {
      document.execCommand(command, false, null);
      document.getElementById("diary-content").focus();
    }

    // æ’å…¥è¡¨æƒ…
    function insertEmoji(emoji) {
      const content = document.getElementById("diary-content");
      content.innerHTML += emoji;
      content.focus();
    }

    // æ’å…¥å›¾ç‰‡
    function insertImage() {
      const input = document.getElementById("imageInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><img src="${e.target.result}" class="preview-img"><br>`;
        content.focus();
      };
      reader.readAsDataURL(file);
      input.value = ''; // é‡ç½®è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
    }

    // æ’å…¥éŸ³é¢‘
    function insertAudio() {
      const input = document.getElementById("audioInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><audio controls class="preview-audio"><source src="${e.target.result}" type="${file.type}"> æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾</audio><br>`;
        content.focus();
      };
      reader.readAsDataURL(file);
      input.value = ''; // é‡ç½®è¾“å…¥
    }

    // æ¶‚é¸¦åŠŸèƒ½
    canvas.addEventListener("mousedown", startDrawing);
    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseout", stopDrawing);
    canvas.addEventListener("mousemove", draw);
    
    // è§¦æ‘¸å±æ”¯æŒ
    canvas.addEventListener("touchstart", (e) => {
      e.preventDefault();
      const pos = getTouchPos(e);
      startDrawing({offsetX: pos.x, offsetY: pos.y});
    });
    
    canvas.addEventListener("touchend", (e) => {
      e.preventDefault();
      stopDrawing();
    });
    
    canvas.addEventListener("touchmove", (e) => {
      e.preventDefault();
      if (!drawing) return;
      const pos = getTouchPos(e);
      draw({offsetX: pos.x, offsetY: pos.y});
    });

    function getTouchPos(e) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: e.touches[0].clientX - rect.left,
        y: e.touches[0].clientY - rect.top
      };
    }

    function startDrawing(e) {
      drawing = true;
      draw(e); // ç”»ä¸‹ç¬¬ä¸€ä¸ªç‚¹
    }

    function stopDrawing() {
      drawing = false;
      ctx.beginPath(); // é‡ç½®è·¯å¾„ï¼Œé¿å…çº¿æ¡è¿æ¥
    }

    function draw(e) {
      if (!drawing) return;
      
      ctx.lineWidth = currentSize;
      ctx.lineCap = 'round';
      ctx.strokeStyle = currentColor;
      
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    }

    // è®¾ç½®ç”»ç¬”é¢œè‰²
    function setBrushColor(color) {
      currentColor = color;
      // æ›´æ–°æ´»åŠ¨é¢œè‰²é€‰é¡¹çš„æ ·å¼
      document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('active');
        if (option.style.background === color) {
          option.classList.add('active');
        }
      });
      // æ›´æ–°è‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨çš„å€¼
      document.getElementById('customColor').value = color;
    }
    
    // è®¾ç½®è‡ªå®šä¹‰é¢œè‰²
    function setCustomColor(color) {
      currentColor = color;
      // åˆ›å»ºæ–°çš„é¢œè‰²é€‰é¡¹æˆ–æ›´æ–°ç°æœ‰é€‰é¡¹
      let hasColor = false;
      document.querySelectorAll('.color-option').forEach(option => {
        option.classList.remove('active');
        if (option.style.background === color) {
          option.classList.add('active');
          hasColor = true;
        }
      });
      // å¦‚æœæ²¡æœ‰è¿™ä¸ªé¢œè‰²é€‰é¡¹ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„é«˜äº®æ˜¾ç¤º
      if (!hasColor) {
        // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åŠ¨æ€åˆ›å»ºæ–°é¢œè‰²é€‰é¡¹çš„ä»£ç 
      }
    }

    // è®¾ç½®ç”»ç¬”å¤§å°
    function setBrushSize(size) {
      currentSize = parseInt(size);
    }

    // æ¸…ç©ºç”»å¸ƒ
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // æ’å…¥æ¶‚é¸¦
    function insertDoodle() {
      const content = document.getElementById("diary-content");
      const dataURL = canvas.toDataURL();
      content.innerHTML += `<br><img src="${dataURL}" class="preview-img"><br>`;
      clearCanvas();
      content.focus();
    }

    // ä¿å­˜æ—¥è®°
    function saveDiary() {
      const time = document.getElementById("time").value;
      const weather = document.getElementById("weather").value;
      const mood = document.getElementById("mood").value;
      const location = document.getElementById("location").value;
      const content = document.getElementById("diary-content").innerHTML;

      if (!time || !content.trim()) {
        alert("è¯·å¡«å†™æ—¶é—´å’Œæ—¥è®°å†…å®¹");
        return;
      }

      // ç”Ÿæˆå”¯ä¸€ID
      const id = currentDiaryId || Date.now().toString();
      
      // åˆ›å»ºæ—¥è®°å¯¹è±¡
      const diary = {
        id,
        time,
        weather,
        mood,
        location,
        content,
        createdAt: new Date().toISOString()
      };

      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      let diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
      
      if (currentDiaryId) {
        // æ›´æ–°ç°æœ‰æ—¥è®°
        diaries = diaries.map(d => d.id === id ? diary : d);
      } else {
        // æ·»åŠ æ–°æ—¥è®°
        diaries.push(diary);
      }
      
      localStorage.setItem('diaries', JSON.stringify(diaries));
      
      // é‡ç½®è¡¨å•
      clearForm();
      
      // æ›´æ–°æ—¥è®°åˆ—è¡¨
      renderDiaryList();
      
      alert(currentDiaryId ? "æ—¥è®°å·²æ›´æ–°" : "æ—¥è®°å·²ä¿å­˜");
    }

    // åŠ è½½æ—¥è®°
    function loadDiary(id) {
      const diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
      const diary = diaries.find(d => d.id === id);
      
      if (diary) {
        currentDiaryId = id;
        document.getElementById("time").value = diary.time;
        document.getElementById("weather").value = diary.weather;
        document.getElementById("mood").value = diary.mood;
        document.getElementById("location").value = diary.location;
        document.getElementById("diary-content").innerHTML = diary.content;
        
        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        window.scrollTo(0, 0);
      }
    }

    // åˆ é™¤æ—¥è®°
    function deleteDiary(id, e) {
      e.stopPropagation(); // é˜²æ­¢è§¦å‘åŠ è½½äº‹ä»¶
      
      if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ")) {
        let diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
        diaries = diaries.filter(d => d.id !== id);
        localStorage.setItem('diaries', JSON.stringify(diaries));
        renderDiaryList();
      }
    }

    // æ¸…ç©ºè¡¨å•
    function clearForm() {
      currentDiaryId = null;
      const now = new Date();
      const local = now.toISOString().slice(0,16);
      document.getElementById("time").value = local;
      document.getElementById("weather").selectedIndex = 0;
      document.getElementById("mood").selectedIndex = 0;
      document.getElementById("location").value = '';
      document.getElementById("diary-content").innerHTML = '';
      clearCanvas();
    }

    // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
    function renderDiaryList() {
      const diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
      const container = document.getElementById("diaryEntries");
      
      // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
      diaries.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      if (diaries.length === 0) {
        container.innerHTML = '<div class="empty-state">è¿˜æ²¡æœ‰æ—¥è®°ï¼Œå¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ç¯‡å§ï¼</div>';
        return;
      }
      
      container.innerHTML = '';
      
      diaries.forEach(diary => {
        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        const date = new Date(diary.time);
        const formattedDate = date.toLocaleString('zh-CN', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        // åˆ›å»ºæ—¥è®°é¢„è§ˆå†…å®¹ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = diary.content;
        const textContent = tempDiv.textContent || '';
        const previewText = textContent.length > 100 ? textContent.substring(0, 100) + '...' : textContent;
        
        // åˆ›å»ºæ—¥è®°æ¡ç›®
        const entry = document.createElement('div');
        entry.className = 'diary-entry';
        entry.onclick = () => loadDiary(diary.id);
        entry.innerHTML = `
          <div class="diary-header">
            <span>${formattedDate}</span>
            <span>${diary.weather} ${diary.mood}</span>
            <button class="delete-btn" onclick="deleteDiary('${diary.id}', event)">åˆ é™¤</button>
          </div>
          <div class="diary-preview">${previewText}</div>
        `;
        
        container.appendChild(entry);
      });
    }

    window.onload = function() {
    // è®¾ç½®å½“å‰æ—¶é—´
    const now = new Date();
    const formattedDate = now.getFullYear() + '-' +
      String(now.getMonth() + 1).padStart(2, '0') + '-' +
      String(now.getDate()).padStart(2, '0') + 'T' +
      String(now.getHours()).padStart(2, '0') + ':' +
      String(now.getMinutes()).padStart(2, '0');
    document.getElementById('time').value = formattedDate;
    
    // åˆå§‹åŒ–ç”»å¸ƒ
    resizeCanvas();
    
    // åŠ è½½æ—¥è®°åˆ—è¡¨
    renderDiaryList();
    
    // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´ç”»å¸ƒå°ºå¯¸
    window.addEventListener('resize', resizeCanvas);
    
    // é¡µé¢åŠ è½½å®Œæˆåå†æ¬¡è°ƒæ•´ç”»å¸ƒï¼Œç¡®ä¿å°ºå¯¸æ­£ç¡®
    setTimeout(resizeCanvas, 100);
    
    // åˆå§‹åŒ–ç¼–è¾‘å™¨åŠŸèƒ½
    initEditor();
  };
  
  // åˆå§‹åŒ–ç¼–è¾‘å™¨åŠŸèƒ½
  function initEditor() {
    const diaryContent = document.getElementById('diary-content');
    const editorPlaceholder = document.getElementById('editorPlaceholder');
    const charCount = document.getElementById('charCount');
    
    // åˆå§‹åŒ–å ä½ç¬¦æ˜¾ç¤º
    updatePlaceholder();
    
    // åˆå§‹åŒ–å­—ç¬¦è®¡æ•°
    updateCharCount();
    
    // ç›‘å¬å†…å®¹å˜åŒ–
    diaryContent.addEventListener('input', function() {
      updatePlaceholder();
      updateCharCount();
    });
    
    // ç›‘å¬ç„¦ç‚¹äº‹ä»¶
    diaryContent.addEventListener('focus', function() {
      if (diaryContent.textContent.trim() === '') {
        editorPlaceholder.style.opacity = '0.5';
      }
    });
    
    // ç›‘å¬å¤±ç„¦äº‹ä»¶
    diaryContent.addEventListener('blur', function() {
      updatePlaceholder();
    });
  }
  
  // æ›´æ–°å ä½ç¬¦æ˜¾ç¤º
  function updatePlaceholder() {
    const diaryContent = document.getElementById('diary-content');
    const editorPlaceholder = document.getElementById('editorPlaceholder');
    
    if (diaryContent.textContent.trim() === '') {
      editorPlaceholder.style.display = 'block';
    } else {
      editorPlaceholder.style.display = 'none';
    }
  }
  
  // æ›´æ–°å­—ç¬¦è®¡æ•°
  function updateCharCount() {
    const diaryContent = document.getElementById('diary-content');
    const charCount = document.getElementById('charCount');
    const count = diaryContent.textContent.length;
    
    charCount.textContent = count + ' å­—ç¬¦';
    
    // æ ¹æ®å­—ç¬¦æ•°é‡å˜åŒ–é¢œè‰²
    if (count > 1000) {
      charCount.style.color = '#e74c3c';
    } else if (count > 800) {
      charCount.style.color = '#f39c12';
    } else {
      charCount.style.color = 'white';
    }
  }
  // æ ¹æ®å¿ƒæƒ…æ”¹å˜èƒŒæ™¯é¢œè‰²
    function changeBackgroundByMood(mood) {
      const body = document.body;
      
      // æ ¹æ®é€‰æ‹©çš„å¿ƒæƒ…è®¾ç½®å¯¹åº”çš„èƒŒæ™¯
      if (mood.includes('å¼€å¿ƒ')) {
        body.style.background = 'var(--mood-happy)';
      } else if (mood.includes('éš¾è¿‡')) {
        body.style.background = 'var(--mood-sad)';
      } else if (mood.includes('ç”Ÿæ°”')) {
        body.style.background = 'var(--mood-angry)';
      } else if (mood.includes('å¹³é™')) {
        body.style.background = 'var(--mood-calm)';
      } else if (mood.includes('æƒŠè®¶')) {
        body.style.background = 'var(--mood-surprised)';
      } else if (mood.includes('çˆ±æ…•')) {
        body.style.background = 'var(--mood-love)';
      } else if (mood.includes('ç–²æƒ«')) {
        body.style.background = 'var(--mood-tired)';
      } else {
        body.style.background = 'var(--default-background)';
      }
      
      // åŒæ—¶æ›´æ–°å¿ƒæƒ…å›¾æ ‡
      updateMoodIcon(mood);
    }
    
    // æ›´æ–°å¿ƒæƒ…å›¾æ ‡
    function updateMoodIcon(mood) {
      const moodIcon = document.querySelector('.mood-item .meta-icon');
      if (moodIcon && mood) {
        // ç¡®ä¿æ­£ç¡®æå–è¡¨æƒ…ç¬¦å·
        const emoji = mood.substring(0, 2); // è¡¨æƒ…ç¬¦å·å¯èƒ½å ç”¨2ä¸ªå­—ç¬¦ä½ç½®
        moodIcon.textContent = emoji;
      }
    }
    
    // æ›´æ–°å¤©æ°”å›¾æ ‡
    function updateWeatherIcon(weather) {
      const weatherIcon = document.querySelector('.weather-item .meta-icon');
      if (weatherIcon && weather) {
        // æå–å¤©æ°”é€‰é¡¹ä¸­çš„è¡¨æƒ…ç¬¦å·
        const emoji = weather.substring(0, 2); // è¡¨æƒ…ç¬¦å·å¯èƒ½å ç”¨2ä¸ªå­—ç¬¦ä½ç½®
        weatherIcon.textContent = emoji;
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // åˆå§‹åŒ–æ—¶åº”ç”¨é»˜è®¤èƒŒæ™¯
      document.body.style.background = 'var(--default-background)';
      
      // åˆå§‹åŒ–å¤©æ°”å›¾æ ‡
      const weatherSelect = document.getElementById('weather');
      if (weatherSelect && weatherSelect.value) {
        updateWeatherIcon(weatherSelect.value);
      }
    });
    
    </script>
  </body>
</html>