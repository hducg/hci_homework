<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ—¶å…‰æ—¥è®° | è®°å½•ç”Ÿæ´»çš„æ¯ä¸€åˆ»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- é…ç½®Tailwindè‡ªå®šä¹‰ä¸»é¢˜ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1', // æŸ”å’Œçš„é›è“è‰²
                        secondary: '#ec4899', // æ¸©æš–çš„ç²‰è‰²
                        accent: '#f59e0b', // æ´»åŠ›æ©™
                        neutral: {
                            50: '#fafafa',
                            100: '#f5f5f5',
                            200: '#e5e5e5',
                            300: '#d4d4d4',
                            700: '#404040',
                            800: '#262626',
                            900: '#171717',
                        }
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 2px 15px rgba(0, 0, 0, 0.05)',
                        'medium': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'hover': '0 8px 30px rgba(0, 0, 0, 0.12)',
                    }
                },
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .text-balance {
                text-wrap: balance;
            }

            .bg-texture {
                background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            }

            .animate-fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }

            .animate-slide-up {
                animation: slideUp 0.3s ease-out;
            }

            .animate-pulse-soft {
                animation: pulseSoft 2s infinite;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            @keyframes slideUp {
                from {
                    transform: translateY(10px);
                    opacity: 0;
                }

                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            @keyframes pulseSoft {
                0%, 100% {
                    opacity: 1;
                }

                50% {
                    opacity: 0.8;
                }
            }
        }
    </style>
</head>

<body class="font-inter bg-neutral-50 bg-texture text-neutral-800 min-h-screen">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  - æ»šåŠ¨æ—¶å˜åŒ–æ ·å¼ -->
    <header id="mainHeader" class="fixed top-0 left-0 right-0 z-40 transition-all duration-300 bg-primary/95 text-white shadow-medium">
        <div class="container mx-auto px-4 py-3 md:py-4 flex justify-between items-center">
            <h1 class="text-[clamp(1.2rem,3vw,1.8rem)] font-semibold flex items-center gap-2">
                <i class="fa fa-book text-accent animate-pulse-soft"></i>
                <span>æ—¶å…‰æ—¥è®°</span>
            </h1>
            <div class="flex gap-2 md:gap-3 items-center">
                <button id="newEntryBtn" class="hidden md:flex items-center gap-1 px-3 py-1.5 rounded-full bg-white/10 hover:bg-white/20 transition-all">
                    <i class="fa fa-plus-circle"></i>
                    <span>æ–°æ—¥è®°</span>
                </button>
                <button id="saveBtn" class="flex items-center gap-1 px-3 py-1.5 rounded-full bg-white text-primary hover:bg-neutral-100 transition-all shadow-sm">
                    <i class="fa fa-save"></i>
                    <span class="hidden sm:inline">ä¿å­˜</span>
                </button>
                <button id="historyBtn" class="flex items-center gap-1 px-3 py-1.5 rounded-full bg-secondary hover:bg-secondary/90 transition-all shadow-sm">
                    <i class="fa fa-history"></i>
                    <span class="hidden sm:inline">å†å²</span>
                </button>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 pt-24 pb-16 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- å·¦ä¾§ï¼šæ—¥è®°åˆ—è¡¨ (å¤§å±å¹•æ˜¾ç¤º) -->
        <div id="diaryList" class="hidden lg:block lg:col-span-4 bg-white rounded-2xl shadow-soft p-4 md:p-5 overflow-y-auto max-h-[calc(100vh-120px)] animate-fade-in">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold flex items-center gap-2">
                    <i class="fa fa-calendar-check-o text-primary"></i>
                    æ—¥è®°åˆ—è¡¨
                </h2>
                <button id="newEntryBtnSide" class="p-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-all">
                    <i class="fa fa-plus"></i>
                </button>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="relative mb-4">
                <input type="text" id="searchDiary" placeholder="æœç´¢æ—¥è®°å†…å®¹..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"></i>
            </div>

            <!-- æ—¥æœŸåˆ†ç»„æ ‡é¢˜ -->
            <div id="entriesContainer" class="space-y-4">
                <!-- æ—¥è®°æ¡ç›®å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                <div class="text-center text-neutral-500 py-12 animate-fade-in">
                    <div class="w-16 h-16 bg-neutral-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fa fa-pencil text-2xl text-neutral-300"></i>
                    </div>
                    <p class="text-neutral-400">å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ç¯‡æ—¥è®°å§</p>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šç¼–è¾‘åŒºåŸŸ -->
        <div class="lg:col-span-8 space-y-5 md:space-y-6 animate-slide-up">
            <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
            <div class="bg-white rounded-2xl shadow-soft p-5 md:p-6 transition-all duration-300 hover:shadow-medium">
                <h2 class="text-lg font-semibold mb-4 pb-2 border-b border-neutral-100 flex items-center gap-2">
                    <i class="fa fa-info-circle text-primary"></i>
                    åŸºæœ¬ä¿¡æ¯
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label class="block text-sm font-medium text-neutral-700 mb-1.5">æ—¶é—´</label>
                        <input type="datetime-local" id="time" class="w-full px-3.5 py-2.5 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all">
                    </div>

                    <div class="form-group">
                        <label class="block text-sm font-medium text-neutral-700 mb-1.5">åœ°ç‚¹</label>
                        <div class="flex gap-2">
                            <input type="text" id="location" placeholder="è¾“å…¥åœ°ç‚¹æˆ–ç‚¹å‡»è·å–ä½ç½®" class="flex-1 px-3.5 py-2.5 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all">
                            <button id="getLocationBtn" class="p-2.5 border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-all">
                                <i class="fa fa-map-marker text-primary"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="block text-sm font-medium text-neutral-700 mb-1.5">å¤©æ°”</label>
                        <select id="weather" class="w-full px-3.5 py-2.5 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all appearance-none bg-white bg-[url('data:image/svg+xml;charset=US-ASCII,<svg width=\" 20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\">
                            <path d=\"M7 10l5 5 5-5H7z\" fill=\"%23404040\" /></svg>')] bg-no-repeat bg-right 0.75rem center">
                            <option>â˜€ï¸ æ™´</option>
                            <option>â›… å¤šäº‘</option>
                            <option>ğŸŒ§ï¸ é›¨</option>
                            <option>ğŸŒ¨ï¸ é›ª</option>
                            <option>ğŸŒ©ï¸ é›·é˜µé›¨</option>
                            <option>ğŸŒ«ï¸ é›¾</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="block text-sm font-medium text-neutral-700 mb-1.5">å¿ƒæƒ…</label>
                        <select id="mood" class="w-full px-3.5 py-2.5 border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all appearance-none bg-white bg-[url('data:image/svg+xml;charset=US-ASCII,<svg width=\" 20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\">
                            <path d=\"M7 10l5 5 5-5H7z\" fill=\"%23404040\" /></svg>')] bg-no-repeat bg-right 0.75rem center">
                            <option>ğŸ˜Š å¼€å¿ƒ</option>
                            <option>ğŸ˜Œ å¹³é™</option>
                            <option>ğŸ˜ ä¸€èˆ¬</option>
                            <option>ğŸ˜” éš¾è¿‡</option>
                            <option>ğŸ˜  ç”Ÿæ°”</option>
                            <option>ğŸ˜² æƒŠè®¶</option>
                            <option>ğŸ˜ å–œæ‚¦</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æ—¥è®°å†…å®¹ç¼–è¾‘åŒº -->
            <div class="bg-white rounded-2xl shadow-soft p-5 md:p-6 transition-all duration-300 hover:shadow-medium">
                <h2 class="text-lg font-semibold mb-4 pb-2 border-b border-neutral-100 flex items-center gap-2">
                    <i class="fa fa-pencil-square-o text-primary"></i>
                    æ—¥è®°å†…å®¹
                </h2>

                <!-- æ–‡æœ¬ç¼–è¾‘å·¥å…·æ  -->
                <div class="flex flex-wrap gap-1.5 mb-4 p-2.5 bg-neutral-50 rounded-xl">
                    <button onclick="formatText('bold')" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="åŠ ç²—">
                        <i class="fa fa-bold"></i>
                    </button>
                    <button onclick="formatText('italic')" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="æ–œä½“">
                        <i class="fa fa-italic"></i>
                    </button>
                    <button onclick="formatText('underline')" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="ä¸‹åˆ’çº¿">
                        <i class="fa fa-underline"></i>
                    </button>
                    <button onclick="formatText('insertUnorderedList')" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="æ— åºåˆ—è¡¨">
                        <i class="fa fa-list-ul"></i>
                    </button>
                    <button onclick="formatText('insertOrderedList')" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="æœ‰åºåˆ—è¡¨">
                        <i class="fa fa-list-ol"></i>
                    </button>
                    <span class="h-6 border-r border-neutral-200 mx-0.5"></span>

                    <div class="relative">
                        <button id="emojiBtn" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="è¡¨æƒ…">
                            <i class="fa fa-smile-o"></i>
                        </button>

                        <!-- è¡¨æƒ…é€‰æ‹©é¢æ¿ -->
                        <div id="emojiPanel" class="absolute bottom-full left-0 mb-2 z-30 hidden bg-white border border-neutral-200 rounded-xl p-3 shadow-medium grid grid-cols-8 gap-2 w-max animate-fade-in">
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ‰')">ğŸ‰</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ’¯')">ğŸ’¯</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ”¥')">ğŸ”¥</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ¥°')">ğŸ¥°</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜')">ğŸ˜</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ¥³')">ğŸ¥³</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ˜´')">ğŸ˜´</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ¤”')">ğŸ¤”</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ‘')">ğŸ‘</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ™')">ğŸ™</span>
                            <span class="emoji text-xl cursor-pointer hover:scale-110 transition-transform" onclick="insertEmoji('ğŸ’”')">ğŸ’”</span>
                        </div>
                    </div>

                    <label class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all cursor-pointer" title="æ’å…¥å›¾ç‰‡">
                        <i class="fa fa-image"></i>
                        <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" class="hidden">
                    </label>
                    <label class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all cursor-pointer" title="æ’å…¥éŸ³é¢‘">
                        <i class="fa fa-microphone"></i>
                        <input type="file" id="audioInput" accept="audio/*" onchange="insertAudio()" class="hidden">
                    </label>
                    <button id="doodleBtn" class="p-2 rounded-lg hover:bg-white hover:shadow-sm transition-all" title="æ¶‚é¸¦">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                </div>

                <!-- å†…å®¹ç¼–è¾‘åŒº -->
                <div id="diary-content" contenteditable="true" class="min-h-[220px] border border-neutral-200 rounded-xl p-4 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all bg-white placeholder-neutral-300" data-placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä»Šå¤©çš„æ•…äº‹..."></div>
            </div>

            <!-- æ¶‚é¸¦åŒºåŸŸ -->
            <div id="doodleContainer" class="bg-white rounded-2xl shadow-soft p-5 md:p-6 transition-all duration-300 hover:shadow-medium hidden animate-fade-in">
                <div class="flex justify-between items-center mb-4 pb-2 border-b border-neutral-100">
                    <h2 class="text-lg font-semibold flex items-center gap-2">
                        <i class="fa fa-paint-brush text-primary"></i>
                        æ¶‚é¸¦æ¿
                    </h2>
                    <button onclick="document.getElementById('doodleContainer').classList.add('hidden')" class="p-1.5 text-neutral-500 hover:text-neutral-700 hover:bg-neutral-50 rounded-full transition-all">
                        <i class="fa fa-times"></i>
                    </button>
                </div>

                <div class="flex flex-wrap gap-3 mb-4">
                    <div class="flex items-center gap-2 bg-neutral-50 px-3 py-1.5 rounded-lg">
                        <label class="text-sm font-medium">é¢œè‰²:</label>
                        <input type="color" id="doodleColor" value="#6366f1" class="w-8 h-8 p-0 border-0 rounded-full cursor-pointer overflow-hidden ring-1 ring-neutral-200">
                    </div>
                    <div class="flex items-center gap-2 bg-neutral-50 px-3 py-1.5 rounded-lg">
                        <label class="text-sm font-medium">ç²—ç»†:</label>
                        <input type="range" id="doodleSize" min="1" max="15" value="3" class="w-28 accent-primary">
                        <span id="sizeValue" class="text-sm font-medium">3px</span>
                    </div>
                    <button onclick="clearCanvas()" class="ml-auto flex items-center gap-1 bg-neutral-50 px-3 py-1.5 rounded-lg hover:bg-neutral-100 transition-all">
                        <i class="fa fa-eraser"></i>
                        <span class="text-sm">æ¸…ç©º</span>
                    </button>
                </div>

                <canvas id="canvas" width="100%" height="300" class="border border-neutral-200 rounded-xl cursor-crosshair bg-white shadow-inner"></canvas>
                <div class="flex justify-end mt-4">
                    <button onclick="insertDoodle(); document.getElementById('doodleContainer').classList.add('hidden')" class="px-4 py-2.5 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all shadow-sm flex items-center gap-1.5">
                        <i class="fa fa-check"></i>
                        <span>æ’å…¥æ¶‚é¸¦</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- ç§»åŠ¨ç«¯åº•éƒ¨æ“ä½œæ  -->
    <div class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-neutral-200 py-2 px-4 flex justify-around items-center z-30 shadow-medium">
        <button id="newEntryBtnMobile" class="flex flex-col items-center justify-center p-2 text-neutral-700">
            <i class="fa fa-plus-circle text-lg"></i>
            <span class="text-xs mt-1">æ–°å»º</span>
        </button>
        <button id="saveBtnMobile" class="flex flex-col items-center justify-center p-2 text-primary">
            <i class="fa fa-save text-lg"></i>
            <span class="text-xs mt-1">ä¿å­˜</span>
        </button>
        <button id="historyBtnMobile" class="flex flex-col items-center justify-center p-2 text-secondary">
            <i class="fa fa-history text-lg"></i>
            <span class="text-xs mt-1">å†å²</span>
        </button>
    </div>

    <!-- å†å²è®°å½•å¼¹çª— -->
    <div id="historyModal" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-hover w-full max-w-md max-h-[85vh] flex flex-col animate-slide-up">
            <div class="p-4 border-b border-neutral-100 flex justify-between items-center">
                <h3 class="font-semibold text-lg flex items-center gap-2">
                    <i class="fa fa-history text-primary"></i>
                    å†å²æ—¥è®°
                </h3>
                <button id="closeHistoryBtn" class="p-2 rounded-full hover:bg-neutral-50 transition-all">
                    <i class="fa fa-times"></i>
                </button>
            </div>

            <!-- æœç´¢æ¡† -->
            <div class="relative p-4 border-b border-neutral-100">
                <input type="text" id="searchDiaryModal" placeholder="æœç´¢æ—¥è®°..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-neutral-200 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                <i class="fa fa-search absolute left-7 top-1/2 -translate-y-1/2 text-neutral-400"></i>
            </div>

            <div id="modalEntriesContainer" class="flex-1 overflow-y-auto p-4 space-y-3">
                <!-- ä¸å·¦ä¾§åˆ—è¡¨å†…å®¹åŒæ­¥ -->
            </div>

            <div class="p-4 border-t border-neutral-100">
                <button id="closeHistoryBtn2" class="w-full py-2.5 border border-neutral-200 rounded-lg hover:bg-neutral-50 transition-all">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div id="toast" class="fixed bottom-20 right-4 bg-neutral-800 text-white px-4 py-2.5 rounded-xl shadow-medium transform translate-y-20 opacity-0 transition-all duration-300 flex items-center gap-2 max-w-xs">
        <i id="toastIcon" class="fa fa-check-circle text-green-400"></i>
        <span id="toastMessage">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        // DOMå…ƒç´ å¼•ç”¨
        const diaryContent = document.getElementById('diary-content');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const doodleContainer = document.getElementById('doodleContainer');
        const doodleBtn = document.getElementById('doodleBtn');
        const emojiBtn = document.getElementById('emojiBtn');
        const emojiPanel = document.getElementById('emojiPanel');
        const doodleSize = document.getElementById('doodleSize');
        const sizeValue = document.getElementById('sizeValue');
        const doodleColor = document.getElementById('doodleColor');
        const saveBtn = document.getElementById('saveBtn');
        const saveBtnMobile = document.getElementById('saveBtnMobile');
        const historyBtn = document.getElementById('historyBtn');
        const historyBtnMobile = document.getElementById('historyBtnMobile');
        const historyModal = document.getElementById('historyModal');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const closeHistoryBtn2 = document.getElementById('closeHistoryBtn2');
        const entriesContainer = document.getElementById('entriesContainer');
        const modalEntriesContainer = document.getElementById('modalEntriesContainer');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        const newEntryBtn = document.getElementById('newEntryBtn');
        const newEntryBtnSide = document.getElementById('newEntryBtnSide');
        const newEntryBtnMobile = document.getElementById('newEntryBtnMobile');
        const searchDiary = document.getElementById('searchDiary');
        const searchDiaryModal = document.getElementById('searchDiaryModal');
        const mainHeader = document.getElementById('mainHeader');

        // åˆå§‹åŒ–å˜é‡
        let drawing = false;
        let currentDiaryId = null;
        const DIARY_STORAGE_KEY = 'multimedia_diaries';

        // åˆå§‹åŒ–ç”»å¸ƒå°ºå¯¸
        function resizeCanvas() {
            if (!canvas) return;
            const container = canvas.parentElement;
            if (container) {
                canvas.width = container.clientWidth;
                // ä¿æŒç”»å¸ƒé«˜å®½æ¯”ï¼Œå¢å¼ºè§†è§‰ä½“éªŒ
                canvas.height = Math.min(300, container.clientWidth * 0.6);
            }
        }
        window.addEventListener('resize', resizeCanvas);

        // åˆå§‹åŒ–é¡µé¢
        window.onload = () => {
            // è®¾ç½®å½“å‰æ—¶é—´
            const now = new Date();
            const local = now.toISOString().slice(0, 16);
            document.getElementById('time').value = local;

            // åˆå§‹åŒ–å ä½ç¬¦æ•ˆæœ
            setupPlaceholder();

            // åŠ è½½å†å²æ—¥è®°
            loadDiaryEntries();

            // åˆå§‹åŒ–ç”»å¸ƒ
            resizeCanvas();

            // æ»šåŠ¨æ•ˆæœç›‘å¬
            window.addEventListener('scroll', handleScroll);

            // åˆå§‹åŒ–è¡¨æƒ…æŒ‰é’®äº¤äº’
            initEmojiInteraction();
        };

        // åˆå§‹åŒ–è¡¨æƒ…æŒ‰é’®äº¤äº’
        function initEmojiInteraction() {
            // ç‚¹å‡»è¡¨æƒ…æŒ‰é’®åˆ‡æ¢é¢æ¿æ˜¾ç¤º/éšè—
            emojiBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                emojiPanel.classList.toggle('hidden');
                if (!emojiPanel.classList.contains('hidden')) {
                    document.addEventListener('click', handleOutsideClick);
                } else {
                    document.removeEventListener('click', handleOutsideClick);
                }
            });

            // ç‚¹å‡»è¡¨æƒ…é¢æ¿å†…éƒ¨ä¸å…³é—­
            emojiPanel.addEventListener('click', (e) => {
                e.stopPropagation();
            });

            // é¼ æ ‡ç¦»å¼€è¡¨æƒ…é¢æ¿æ—¶å…³é—­
            emojiPanel.addEventListener('mouseleave', () => {
                emojiPanel.classList.add('hidden');
                document.removeEventListener('click', handleOutsideClick);
            });
        }

        // å¤„ç†ç‚¹å‡»å¤–éƒ¨å…³é—­è¡¨æƒ…é¢æ¿
        function handleOutsideClick(e) {
            if (!emojiBtn.contains(e.target) && !emojiPanel.contains(e.target)) {
                emojiPanel.classList.add('hidden');
                document.removeEventListener('click', handleOutsideClick);
            }
        }

        // å¤„ç†æ»šåŠ¨æ•ˆæœ - å¯¼èˆªæ æ ·å¼å˜åŒ–
        function handleScroll() {
            if (window.scrollY > 10) {
                mainHeader.classList.add('py-2', 'shadow-medium');
                mainHeader.classList.remove('py-3', 'md:py-4', 'shadow-soft');
            } else {
                mainHeader.classList.remove('py-2', 'shadow-medium');
                mainHeader.classList.add('py-3', 'md:py-4', 'shadow-soft');
            }
        }

        // æ–‡æœ¬æ ¼å¼åŒ–åŠŸèƒ½
        function formatText(command) {
            document.execCommand(command, false, null);
            diaryContent.focus();
            // æ·»åŠ æ“ä½œåé¦ˆ
            addTemporaryStyle(diaryContent, 'bg-primary/5');
        }

        // ä¸ºå…ƒç´ æ·»åŠ ä¸´æ—¶æ ·å¼åé¦ˆ
        function addTemporaryStyle(element, styleClass) {
            element.classList.add(styleClass);
            setTimeout(() => {
                element.classList.remove(styleClass);
            }, 300);
        }

        // ä¼˜åŒ–è¡¨æƒ…æ’å…¥åŠŸèƒ½ - ç¡®ä¿æ’å…¥åˆ°å†…å®¹æœ«å°¾
        function insertEmoji(emoji) {
            // å¤„ç†å ä½ç¬¦æ–‡æœ¬
            const placeholder = diaryContent.getAttribute('data-placeholder');
            if (diaryContent.innerHTML.trim() === `<span class="text-neutral-300">${placeholder}</span>`) {
                diaryContent.innerHTML = '';
            }

            // åˆ›å»ºè¡¨æƒ…æ–‡æœ¬èŠ‚ç‚¹
            const textNode = document.createTextNode(emoji);

            // å°†è¡¨æƒ…æ·»åŠ åˆ°å†…å®¹çš„æœ€å
            diaryContent.appendChild(textNode);

            // ç§»åŠ¨å…‰æ ‡åˆ°è¡¨æƒ…ä¹‹å
            const selection = window.getSelection();
            const range = document.createRange();
            range.setStartAfter(textNode);
            range.setEndAfter(textNode);
            selection.removeAllRanges();
            selection.addRange(range);

            // ç¡®ä¿æ—¥è®°å†…å®¹åŒºè·å¾—ç„¦ç‚¹
            diaryContent.focus();

            addTemporaryStyle(diaryContent, 'bg-primary/5');
            // æ’å…¥è¡¨æƒ…åå…³é—­é¢æ¿
            emojiPanel.classList.add('hidden');
            document.removeEventListener('click', handleOutsideClick);
        }

        // æ’å…¥å›¾ç‰‡
        function insertImage() {
            const input = document.getElementById('imageInput');
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-img my-3 max-w-full h-auto rounded-xl shadow-soft transition-all hover:shadow-medium';
                img.onload = () => {
                    // å¤„ç†å ä½ç¬¦
                    const placeholder = diaryContent.getAttribute('data-placeholder');
                    if (diaryContent.innerHTML.trim() === `<span class="text-neutral-300">${placeholder}</span>`) {
                        diaryContent.innerHTML = '';
                    }

                    // æ·»åŠ æ·¡å…¥åŠ¨ç”»
                    img.classList.add('opacity-0');
                    diaryContent.appendChild(img);
                    diaryContent.appendChild(document.createElement('br'));
                    setTimeout(() => {
                        img.classList.remove('opacity-0');
                        img.classList.add('opacity-100', 'transition-opacity', 'duration-300');
                    }, 10);
                    diaryContent.focus();
                    showToast('å›¾ç‰‡æ’å…¥æˆåŠŸ');
                };
            };
            reader.readAsDataURL(file);
            input.value = ''; // é‡ç½®è¾“å…¥
        }

        // æ’å…¥éŸ³é¢‘
        function insertAudio() {
            const input = document.getElementById('audioInput');
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const audioContainer = document.createElement('div');
                audioContainer.className = 'my-3 p-3 bg-neutral-50 rounded-xl';

                const audio = document.createElement('audio');
                audio.controls = true;
                audio.className = 'preview-audio w-full';
                const source = document.createElement('source');
                source.src = e.target.result;
                source.type = file.type;
                audio.appendChild(source);

                const audioName = document.createElement('div');
                audioName.className = 'text-xs text-neutral-500 mt-1.5';
                audioName.textContent = `éŸ³é¢‘: ${file.name}`;

                audioContainer.appendChild(audio);
                audioContainer.appendChild(audioName);

                // å¤„ç†å ä½ç¬¦
                const placeholder = diaryContent.getAttribute('data-placeholder');
                if (diaryContent.innerHTML.trim() === `<span class="text-neutral-300">${placeholder}</span>`) {
                    diaryContent.innerHTML = '';
                }

                // æ·»åŠ æ·¡å…¥åŠ¨ç”»
                audioContainer.classList.add('opacity-0');
                diaryContent.appendChild(audioContainer);
                diaryContent.appendChild(document.createElement('br'));
                setTimeout(() => {
                    audioContainer.classList.remove('opacity-0');
                    audioContainer.classList.add('opacity-100', 'transition-opacity', 'duration-300');
                }, 10);

                diaryContent.focus();
                showToast('éŸ³é¢‘æ’å…¥æˆåŠŸ');
            };
            reader.readAsDataURL(file);
            input.value = '';
        }

        // æ¶‚é¸¦åŠŸèƒ½
        canvas.addEventListener('mousedown', (e) => {
            drawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        });

        canvas.addEventListener('mouseup', () => drawing = false);
        canvas.addEventListener('mouseout', () => drawing = false);

        canvas.addEventListener('mousemove', draw);

        // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            drawing = true;
            ctx.beginPath();
            ctx.moveTo(x, y);
        });

        canvas.addEventListener('touchend', () => drawing = false);
        canvas.addEventListener('touchcancel', () => drawing = false);

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            draw({ clientX: touch.clientX, clientY: touch.clientY });
        });

        // ç»˜åˆ¶å‡½æ•°
        function draw(e) {
            if (!drawing) return;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.strokeStyle = doodleColor.value;
            ctx.lineWidth = doodleSize.value;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        // æ¶‚é¸¦æ¿æ§åˆ¶
        doodleBtn.addEventListener('click', () => {
            doodleContainer.classList.toggle('hidden');
            if (!doodleContainer.classList.contains('hidden')) {
                resizeCanvas();
                // æ·»åŠ è¿›å…¥åŠ¨ç”»
                doodleContainer.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    doodleContainer.classList.remove('scale-95', 'opacity-0');
                    doodleContainer.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
                }, 10);
            }
        });

        // æ›´æ–°ç”»ç¬”å¤§å°æ˜¾ç¤º
        doodleSize.addEventListener('input', () => {
            sizeValue.textContent = `${doodleSize.value}px`;
            // å®æ—¶é¢„è§ˆç”»ç¬”å¤§å°
            const previewDot = document.createElement('div');
            previewDot.className = 'fixed pointer-events-none z-50 transition-opacity duration-300 opacity-0';
            previewDot.style.width = `${doodleSize.value}px`;
            previewDot.style.height = `${doodleSize.value}px`;
            previewDot.style.backgroundColor = doodleColor.value;
            previewDot.style.borderRadius = '50%';
            previewDot.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(previewDot);

            setTimeout(() => {
                previewDot.classList.add('opacity-100');
            }, 10);

            setTimeout(() => {
                previewDot.classList.remove('opacity-100');
                previewDot.classList.add('opacity-0');
                setTimeout(() => {
                    document.body.removeChild(previewDot);
                }, 300);
            }, 800);
        });

        // æ¸…ç©ºç”»å¸ƒ
        function clearCanvas() {
            // æ·»åŠ æ·¡å‡ºæ•ˆæœ
            const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            showToast('ç”»å¸ƒå·²æ¸…ç©º');
        }

        // æ’å…¥æ¶‚é¸¦
        function insertDoodle() {
            const dataURL = canvas.toDataURL();
            const img = document.createElement('img');
            img.src = dataURL;
            img.className = 'preview-img my-3 max-w-full h-auto rounded-xl shadow-soft transition-all hover:shadow-medium opacity-0';

            // å¤„ç†å ä½ç¬¦
            const placeholder = diaryContent.getAttribute('data-placeholder');
            if (diaryContent.innerHTML.trim() === `<span class="text-neutral-300">${placeholder}</span>`) {
                diaryContent.innerHTML = '';
            }

            diaryContent.appendChild(img);
            diaryContent.appendChild(document.createElement('br'));

            // æ·¡å…¥åŠ¨ç”»
            setTimeout(() => {
                img.classList.remove('opacity-0');
                img.classList.add('opacity-100', 'transition-opacity', 'duration-300');
            }, 10);

            clearCanvas();
            diaryContent.focus();
            showToast('æ¶‚é¸¦æ’å…¥æˆåŠŸ');
        }

        // è·å–ä½ç½®ä¿¡æ¯
        getLocationBtn.addEventListener('click', () => {
            if (!navigator.geolocation) {
                showToast('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒä½ç½®æœåŠ¡', 'error');
                return;
            }

            showToast('æ­£åœ¨è·å–ä½ç½®...', 'loading');
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // è¿™é‡Œå¯ä»¥è°ƒç”¨é€†åœ°ç†ç¼–ç APIè·å–å…·ä½“åœ°å€ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†
                    document.getElementById('location').value = `çº¬åº¦: ${position.coords.latitude.toFixed(2)}, ç»åº¦: ${position.coords.longitude.toFixed(2)}`;
                    showToast('ä½ç½®è·å–æˆåŠŸ');
                },
                (error) => {
                    showToast('ä½ç½®è·å–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥', 'error');
                    console.error(error);
                }
            );
        });

        // ä¿å­˜æ—¥è®°
        function saveDiary() {
            const time = document.getElementById('time').value;
            const weather = document.getElementById('weather').value;
            const mood = document.getElementById('mood').value;
            const location = document.getElementById('location').value;
            const content = diaryContent.innerHTML;

            if (!time) {
                showToast('è¯·é€‰æ‹©æ—¶é—´', 'error');
                document.getElementById('time').focus();
                return;
            }

            if (!content.trim()) {
                showToast('è¯·å¡«å†™æ—¥è®°å†…å®¹', 'error');
                diaryContent.focus();
                return;
            }

            // æ„å»ºæ—¥è®°å¯¹è±¡
            const diary = {
                id: currentDiaryId || Date.now().toString(),
                time,
                weather,
                mood,
                location,
                content,
                createdAt: new Date().toISOString()
            };

            // ä»æœ¬åœ°å­˜å‚¨è·å–ç°æœ‰æ—¥è®°
            const diaries = JSON.parse(localStorage.getItem(DIARY_STORAGE_KEY) || '[]');

            // æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åŒIDçš„æ—¥è®°ï¼ˆæ›´æ–°æ“ä½œï¼‰
            const index = diaries.findIndex(d => d.id === diary.id);
            if (index > -1) {
                diaries[index] = diary;
            } else {
                diaries.push(diary);
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆæŒ‰æ—¶é—´æ’åºï¼‰
            diaries.sort((a, b) => new Date(b.time) - new Date(a.time));
            localStorage.setItem(DIARY_STORAGE_KEY, JSON.stringify(diaries));

            // æ›´æ–°UI
            currentDiaryId = diary.id;
            loadDiaryEntries();
            showToast(currentDiaryId === diary.id && index > -1 ? 'æ—¥è®°æ›´æ–°æˆåŠŸ' : 'æ—¥è®°ä¿å­˜æˆåŠŸ');

            // ä¿å­˜æŒ‰é’®åé¦ˆåŠ¨ç”»
            [saveBtn, saveBtnMobile].forEach(btn => {
                btn.classList.add('scale-95');
                setTimeout(() => btn.classList.remove('scale-95'), 200);
            });
        }

        saveBtn.addEventListener('click', saveDiary);
        saveBtnMobile.addEventListener('click', saveDiary);

        // åŠ è½½æ—¥è®°åˆ—è¡¨ - å–æ¶ˆé€‰ä¸­å˜è‰²åŠŸèƒ½
        function loadDiaryEntries(filterText = '') {
            const diaries = JSON.parse(localStorage.getItem(DIARY_STORAGE_KEY) || '[]');
            entriesContainer.innerHTML = '';
            modalEntriesContainer.innerHTML = '';

            // è¿‡æ»¤æ—¥è®°
            const filteredDiaries = filterText
                ? diaries.filter(d =>
                    d.content.toLowerCase().includes(filterText.toLowerCase()) ||
                    d.location.toLowerCase().includes(filterText.toLowerCase())
                )
                : diaries;

            if (filteredDiaries.length === 0) {
                const emptyMsg = `
                  <div class="text-center text-neutral-500 py-12 animate-fade-in">
                    <div class="w-16 h-16 bg-neutral-50 rounded-full flex items-center justify-center mx-auto mb-3">
                      <i class="fa fa-search text-2xl text-neutral-300"></i>
                    </div>
                    <p class="text-neutral-400">${filterText ? 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥è®°' : 'å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ç¯‡æ—¥è®°å§'}</p>
                  </div>
                `;
                entriesContainer.innerHTML = emptyMsg;
                modalEntriesContainer.innerHTML = emptyMsg;
                return;
            }

            // æŒ‰æ—¥æœŸåˆ†ç»„
            const groupedDiaries = {};
            filteredDiaries.forEach(diary => {
                const date = new Date(diary.time).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
                if (!groupedDiaries[date]) {
                    groupedDiaries[date] = [];
                }
                groupedDiaries[date].push(diary);
            });

            // ç”Ÿæˆæ—¥è®°æ¡ç›®
            Object.entries(groupedDiaries).forEach(([date, dateDiaries]) => {
                // æ·»åŠ æ—¥æœŸæ ‡é¢˜
                const dateHeader = `
                  <div class="text-xs uppercase font-semibold text-neutral-500 pt-2 pb-1">
                    ${date}
                  </div>
                `;

                entriesContainer.innerHTML += dateHeader;
                modalEntriesContainer.innerHTML += dateHeader;

                // æ·»åŠ è¯¥æ—¥æœŸä¸‹çš„æ‰€æœ‰æ—¥è®°
                dateDiaries.forEach(diary => {
                    const date = new Date(diary.time);
                    const formattedTime = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    const plainText = diary.content.replace(/<[^>]*>?/gm, '');
                    const previewText = plainText.length > 60 ? plainText.substring(0, 60) + '...' : plainText;

                    const entryHtml = `
                    <div class="p-3 border border-neutral-100 rounded-xl hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all group" data-id="${diary.id}">
                      <div class="flex justify-between items-start mb-1.5">
                        <div class="font-medium text-neutral-800">${formattedTime}</div>
                        <div class="flex gap-1.5">
                          <span class="text-sm">${diary.mood}</span>
                          <span class="text-sm">${diary.weather}</span>
                        </div>
                      </div>
                      <div class="text-sm text-neutral-600 truncate mb-2">${diary.location || 'æ— åœ°ç‚¹ä¿¡æ¯'}</div>
                      <div class="text-xs text-neutral-500 line-clamp-2">${previewText}</div>
                      <div class="absolute inset-0 bg-primary/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none"></div>
                    </div>
                  `;

                    entriesContainer.innerHTML += entryHtml;
                    modalEntriesContainer.innerHTML += entryHtml;
                });
            });

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - ç§»é™¤é€‰ä¸­å˜è‰²é€»è¾‘
            document.querySelectorAll('#entriesContainer > div[data-id], #modalEntriesContainer > div[data-id]').forEach(el => {
                el.addEventListener('click', () => {
                    const id = el.getAttribute('data-id');
                    loadDiary(id);
                    // å…³é—­ç§»åŠ¨ç«¯å¼¹çª—
                    historyModal.classList.add('hidden');
                });
            });
        }

        // æœç´¢æ—¥è®°
        function handleSearch(e) {
            const searchText = e.target.value;
            loadDiaryEntries(searchText);
        }

        searchDiary.addEventListener('input', handleSearch);
        searchDiaryModal.addEventListener('input', handleSearch);

        // åŠ è½½å•ç¯‡æ—¥è®°
        function loadDiary(id) {
            const diaries = JSON.parse(localStorage.getItem(DIARY_STORAGE_KEY) || '[]');
            const diary = diaries.find(d => d.id === id);
            if (!diary) return;

            currentDiaryId = id;
            document.getElementById('time').value = diary.time;
            document.getElementById('weather').value = diary.weather;
            document.getElementById('mood').value = diary.mood;
            document.getElementById('location').value = diary.location;

            // æ·»åŠ å†…å®¹åŠ è½½åŠ¨ç”»
            diaryContent.classList.add('opacity-50');
            setTimeout(() => {
                diaryContent.innerHTML = diary.content;
                diaryContent.classList.remove('opacity-50');
                showToast('æ—¥è®°åŠ è½½æˆåŠŸ');
            }, 300);
        }

        // æ–°å»ºæ—¥è®°
        function newDiaryEntry() {
            currentDiaryId = null;
            const now = new Date();
            const local = now.toISOString().slice(0, 16);
            document.getElementById('time').value = local;
            document.getElementById('weather').selectedIndex = 0;
            document.getElementById('mood').selectedIndex = 0;
            document.getElementById('location').value = '';
            diaryContent.innerHTML = '';

            // åŠ¨ç”»åé¦ˆ
            [newEntryBtn, newEntryBtnSide, newEntryBtnMobile].forEach(btn => {
                if (btn) {
                    btn.classList.add('scale-95');
                    setTimeout(() => btn.classList.remove('scale-95'), 200);
                }
            });

            diaryContent.focus();
            showToast('æ–°å»ºæ—¥è®°');
        }

        newEntryBtn.addEventListener('click', newDiaryEntry);
        newEntryBtnSide.addEventListener('click', newDiaryEntry);
        newEntryBtnMobile.addEventListener('click', newDiaryEntry);

        // å†å²è®°å½•å¼¹çª—æ§åˆ¶
        function openHistoryModal() {
            historyModal.classList.remove('hidden');
            // åŒæ­¥æœç´¢æ¡†å†…å®¹
            searchDiaryModal.value = searchDiary.value;
        }

        historyBtn.addEventListener('click', openHistoryModal);
        historyBtnMobile.addEventListener('click', openHistoryModal);

        function closeHistoryModal() {
            historyModal.classList.add('hidden');
        }

        closeHistoryBtn.addEventListener('click', closeHistoryModal);
        closeHistoryBtn2.addEventListener('click', closeHistoryModal);

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal) {
                closeHistoryModal();
            }
        });

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;

            // è®¾ç½®å›¾æ ‡å’Œæ ·å¼
            if (type === 'success') {
                toastIcon.className = 'fa fa-check-circle text-green-400';
            } else if (type === 'error') {
                toastIcon.className = 'fa fa-exclamation-circle text-red-400';
            } else if (type === 'loading') {
                toastIcon.className = 'fa fa-circle-o-notch fa-spin text-blue-400';
            }

            // æ˜¾ç¤ºåŠ¨ç”»
            toast.classList.remove('translate-y-20', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');

            // è‡ªåŠ¨å…³é—­ï¼ˆåŠ è½½çŠ¶æ€ä¸è‡ªåŠ¨å…³é—­ï¼‰
            if (type !== 'loading') {
                clearTimeout(window.toastTimeout);
                window.toastTimeout = setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 2500);
            }
        }

        // ä¸ºcontenteditableæ·»åŠ å ä½ç¬¦åŠŸèƒ½
        function setupPlaceholder() {
            const placeholder = diaryContent.getAttribute('data-placeholder');

            // åˆå§‹åŒ–æ˜¾ç¤º
            if (!diaryContent.innerHTML.trim()) {
                diaryContent.innerHTML = `<span class="text-neutral-300">${placeholder}</span>`;
            }

            // èšç„¦æ—¶æ¸…é™¤å ä½ç¬¦
            diaryContent.addEventListener('focus', () => {
                if (diaryContent.innerHTML.trim() === `<span class="text-neutral-300">${placeholder}</span>`) {
                    diaryContent.innerHTML = '';
                }
            });

            // å¤±ç„¦æ—¶æ¢å¤å ä½ç¬¦
            diaryContent.addEventListener('blur', () => {
                if (!diaryContent.innerHTML.trim()) {
                    diaryContent.innerHTML = `<span class="text-neutral-300">${placeholder}</span>`;
                }
            });
        }
    </script>
</body>
</html>