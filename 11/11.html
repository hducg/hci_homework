<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¤šåª’ä½“æ—¥è®°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#a8d1ff',
            secondary: '#f7f9fc',
            accent: '#74b9ff',
            dark: '#2d3436',
            button: '#60a5fa'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .diary-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .bg-pattern {
        background-image: url('https://gips3.baidu.com/it/u=800779955,3982912215&fm=3074&app=3074&f=PNG?w=1440&h=2560');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-blend-mode: overlay;
      }
      .btn-effect {
        transition: all 0.2s ease;
      }
      .btn-effect:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(96, 165, 250, 0.3);
      }
      .btn-effect:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(96, 165, 250, 0.2);
      }
    }
  </style>
</head>

<body class="bg-secondary bg-pattern bg-opacity-10 min-h-screen">
  <!-- æ ‡é¢˜åŒºåŸŸ -->
  <header class="bg-primary bg-opacity-80 py-6 px-4 shadow-md">
    <div class="container mx-auto">
      <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-center text-gray-800 tracking-wide">
        <i class="fa fa-book mr-3"></i>å¤šåª’ä½“æ—¥è®°
      </h1>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- å·¦ä¾§ï¼šåŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
      <div class="lg:w-1/3 bg-white rounded-xl p-6 diary-shadow">
        <h2 class="text-xl font-semibold text-gray-800 mb-5 flex items-center">
          <i class="fa fa-info-circle text-accent mr-2"></i>æ—¥è®°ä¿¡æ¯
        </h2>
        
        <div class="space-y-5">
          <!-- æ—¶é—´é€‰æ‹© -->
          <div>
            <label class="block text-gray-700 font-medium mb-2" for="time">
              <i class="fa fa-clock-o mr-1"></i>æ—¶é—´
            </label>
            <input type="datetime-local" id="time" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-all" />
          </div>
          
          <!-- å¤©æ°”é€‰æ‹© -->
          <div>
            <label class="block text-gray-700 font-medium mb-2" for="weather">
              <i class="fa fa-cloud mr-1"></i>å¤©æ°”
            </label>
            <select id="weather" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-all">
              <option>â˜€ï¸ æ™´</option>
              <option>â›… å¤šäº‘</option>
              <option>ğŸŒ¤ï¸ æ™´é—´å¤šäº‘</option>
              <option>ğŸŒ§ï¸ é›¨</option>
              <option>ğŸŒ¨ï¸ é›ª</option>
              <option>ğŸŒ©ï¸ é›·é˜µé›¨</option>
              <option>ğŸŒ«ï¸ é›¾</option>
              <option>ğŸŒªï¸ æ²™å°˜æš´</option>
            </select>
          </div>
          
          <!-- å¿ƒæƒ…é€‰æ‹© -->
          <div>
            <label class="block text-gray-700 font-medium mb-2" for="mood">
              <i class="fa fa-heart mr-1"></i>å¿ƒæƒ…
            </label>
            <select id="mood" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-all">
              <option>ğŸ˜Š å¼€å¿ƒ</option>
              <option>ğŸ˜ƒ éå¸¸å¼€å¿ƒ</option>
              <option>ğŸ˜” éš¾è¿‡</option>
              <option>ğŸ˜¢ æ‚²ä¼¤</option>
              <option>ğŸ˜  ç”Ÿæ°”</option>
              <option>ğŸ˜Œ å¹³é™</option>
              <option>ğŸ˜ çˆ±æ…•</option>
              <option>ğŸ˜¨ å®³æ€•</option>
              <option>ğŸ˜´ ç–²æƒ«</option>
              <option>ğŸ¤” æ€è€ƒ</option>
            </select>
          </div>
          
          <!-- åœ°ç‚¹è¾“å…¥ -->
          <div>
            <label class="block text-gray-700 font-medium mb-2" for="location">
              <i class="fa fa-map-marker mr-1"></i>åœ°ç‚¹
            </label>
            <input type="text" id="location" placeholder="è¯·è¾“å…¥åœ°ç‚¹"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent focus:border-accent transition-all" />
          </div>
          
          <!-- æ¶‚é¸¦åŒºåŸŸ -->
          <div>
            <label class="block text-gray-700 font-medium mb-2">
              <i class="fa fa-paint-brush mr-1"></i>æ¶‚é¸¦æ¿
            </label>
            <div class="border border-gray-300 rounded-lg overflow-hidden">
              <canvas id="canvas" width="600" height="400" class="w-full"></canvas>
              
              <!-- æ¶‚é¸¦å·¥å…·æ  -->
              <div class="bg-gray-50 p-3 flex flex-wrap gap-2 items-center">
                <label class="text-sm text-gray-600">é¢œè‰²:</label>
                <input type="color" id="brushColor" value="#000000" class="w-8 h-8 p-0 border-0 rounded-full cursor-pointer">
                
                <label class="text-sm text-gray-600 ml-2">ç²—ç»†:</label>
                <input type="range" id="brushSize" min="1" max="10" value="2" class="w-24">
                <span id="sizeValue" class="text-sm text-gray-600">2px</span>
                
                <button onclick="clearCanvas()" class="ml-auto text-sm bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded transition-colors">
                  <i class="fa fa-eraser mr-1"></i>æ¸…ç©ºç”»å¸ƒ
                </button>
              </div>
            </div>
            <button onclick="insertDoodle()" class="mt-2 w-full bg-button text-white py-2 rounded-lg transition-colors btn-effect">
              <i class="fa fa-image mr-1"></i>æ’å…¥æ¶‚é¸¦
            </button>
          </div>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šæ—¥è®°å†…å®¹åŒºåŸŸ -->
      <div class="lg:w-2/3 bg-white rounded-xl p-6 diary-shadow">
        <h2 class="text-xl font-semibold text-gray-800 mb-5 flex items-center">
          <i class="fa fa-pencil text-accent mr-2"></i>æ—¥è®°å†…å®¹
        </h2>
        
        <!-- äº‹ä»¶ä¸æ„Ÿæƒ³ -->
        <div class="mb-6">
          <label class="block text-gray-700 font-medium mb-2" for="diary-content">
            äº‹ä»¶ä¸æ„Ÿæƒ³
          </label>
          <div id="diary-content" contenteditable="true" 
               class="w-full min-h-[300px] border border-gray-300 rounded-lg p-4 focus:ring-2 focus:ring-accent focus:border-accent transition-all outline-none"></div>
        </div>
        
        <!-- æ’å…¥å·¥å…·æ  -->
        <div class="bg-gray-50 p-4 rounded-lg mb-6">
          <h3 class="text-gray-700 font-medium mb-3">æ’å…¥å†…å®¹</h3>
          
          <!-- è¡¨æƒ…æ’å…¥ -->
          <div class="mb-4">
            <label class="block text-sm text-gray-600 mb-2">è¡¨æƒ…:</label>
            <div class="flex flex-wrap gap-2">
              <button onclick="insertEmoji('ğŸ˜Š')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ˜Š</button>
              <button onclick="insertEmoji('ğŸ˜¢')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ˜¢</button>
              <button onclick="insertEmoji('â¤ï¸')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">â¤ï¸</button>
              <button onclick="insertEmoji('ğŸ‘')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ‘</button>
              <button onclick="insertEmoji('ğŸ‰')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ‰</button>
              <button onclick="insertEmoji('ğŸ”¥')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ”¥</button>
              <button onclick="insertEmoji('ğŸ¤”')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ¤”</button>
              <button onclick="insertEmoji('ğŸ˜')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ˜</button>
              <button onclick="insertEmoji('ğŸ‘')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ‘</button>
              <button onclick="insertEmoji('ğŸ¤©')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ¤©</button>
              <button onclick="insertEmoji('ğŸ˜')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ˜</button>
              <button onclick="insertEmoji('ğŸ¥³')" class="text-2xl hover:bg-gray-200 p-1 rounded transition-colors">ğŸ¥³</button>
            </div>
          </div>
          
          <!-- åª’ä½“æ’å…¥ -->
          <div class="flex flex-wrap gap-3">
            <label class="flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg cursor-pointer transition-colors">
              <i class="fa fa-picture-o mr-2"></i>æ’å…¥å›¾ç‰‡
              <input type="file" id="imageInput" accept="image/*" onchange="insertImage()" class="hidden" />
            </label>
            
            <label class="flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg cursor-pointer transition-colors">
              <i class="fa fa-microphone mr-2"></i>
              <span id="audioStatus">å½•åˆ¶è¯­éŸ³</span>
              <input type="file" id="audioInput" accept="audio/*" onchange="insertAudioFromFile()" class="hidden" />
            </label>
            
            <button id="recordButton" class="flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition-colors">
              <i class="fa fa-circle-o text-red-500 mr-2"></i>å¼€å§‹å½•éŸ³
            </button>
          </div>
          
          <!-- è¯­éŸ³å½•åˆ¶çŠ¶æ€ -->
          <div id="recordingIndicator" class="hidden mt-3 text-sm text-gray-600">
            <i class="fa fa-circle text-red-500 animate-pulse mr-1"></i>æ­£åœ¨å½•éŸ³...
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="mt-6 flex gap-4">
          <button id="clearButton" class="flex-1 bg-button hover:bg-button/90 text-white py-3 rounded-lg text-lg font-medium transition-all btn-effect">
            <i class="fa fa-trash mr-2"></i>æ¸…ç©ºå†…å®¹
          </button>
          <button id="saveButton" class="flex-1 bg-button hover:bg-button/90 text-white py-3 rounded-lg text-lg font-medium transition-all btn-effect">
            <i class="fa fa-save mr-2"></i>ä¿å­˜æ—¥è®°
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer class="mt-12 py-4 bg-gray-100 bg-opacity-80">
    <div class="container mx-auto px-4 text-center text-gray-600 text-sm">
      <p>å¤šåª’ä½“æ—¥è®° &copy; 2023 - è®°å½•ç”Ÿæ´»çš„ç¾å¥½ç¬é—´</p>
    </div>
  </footer>

  <script>
    // åˆå§‹åŒ–æœ¬åœ°å®æ—¶æ—¶é—´
    window.onload = () => 
    {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const localTime = `${year}-${month}-${day}T${hours}:${minutes}`;
      document.getElementById("time").value = localTime;
    };

    // è¡¨æƒ…æ’å…¥
    function insertEmoji(emoji) {
      const content = document.getElementById("diary-content");
      content.innerHTML += emoji;
      const range = document.createRange();
      const sel = window.getSelection();
      range.setStartAfter(content.lastChild);
      range.collapse(true);
      sel.removeAllRanges();
      sel.addRange(range);
      content.focus();
    }

    // æ’å…¥å›¾ç‰‡
    function insertImage() {
      const input = document.getElementById("imageInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        const img = document.createElement('img');
        img.src = e.target.result;
        img.className = 'preview-img my-2 max-w-full h-auto rounded-lg shadow-sm';
        
        img.addEventListener('click', () => {
          const modal = document.createElement('div');
          modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4';
          modal.innerHTML = `<img src="${img.src}" class="max-h-[90vh] max-w-[90vw] object-contain" />`;
          modal.addEventListener('click', () => modal.remove());
          document.body.appendChild(modal);
        });
        
        content.appendChild(document.createElement('br'));
        content.appendChild(img);
        content.appendChild(document.createElement('br'));
        input.value = '';
      };
      reader.readAsDataURL(file);
    }

    // ä»æ–‡ä»¶æ’å…¥éŸ³é¢‘
    function insertAudioFromFile() {
      const input = document.getElementById("audioInput");
      const file = input.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const content = document.getElementById("diary-content");
        content.innerHTML += `<br><audio controls class="preview-audio my-2 w-full max-w-md">
                               <source src="${e.target.result}" type="${file.type}">
                               æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                              </audio><br>`;
        input.value = '';
      };
      reader.readAsDataURL(file);
    }

    // è¯­éŸ³å½•åˆ¶
    let mediaRecorder;
    let audioChunks = [];
    const recordButton = document.getElementById('recordButton');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const audioStatus = document.getElementById('audioStatus');

    recordButton.addEventListener('click', async () => {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        recordButton.innerHTML = '<i class="fa fa-circle-o text-red-500 mr-2"></i>å¼€å§‹å½•éŸ³';
        recordingIndicator.classList.add('hidden');
        audioStatus.textContent = 'å½•åˆ¶è¯­éŸ³';
      } else {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];
          
          mediaRecorder.addEventListener('dataavailable', event => {
            audioChunks.push(event.data);
          });
          
          mediaRecorder.addEventListener('stop', () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            
            const content = document.getElementById("diary-content");
            content.innerHTML += `<br><audio controls class="preview-audio my-2 w-full max-w-md">
                                   <source src="${audioUrl}" type="audio/wav">
                                   æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
                                  </audio><br>`;
            
            stream.getTracks().forEach(track => track.stop());
          });
          
          mediaRecorder.start();
          recordButton.innerHTML = '<i class="fa fa-stop mr-2"></i>åœæ­¢å½•éŸ³';
          recordingIndicator.classList.remove('hidden');
          audioStatus.textContent = 'æˆ–é€‰æ‹©éŸ³é¢‘æ–‡ä»¶';
        } catch (error) {
          console.error('å½•éŸ³æƒé™è¢«æ‹’ç»:', error);
          alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼Œè¯·ç¡®ä¿å·²æˆäºˆæƒé™ã€‚');
        }
      }
    });

    // æ¶‚é¸¦åŠŸèƒ½
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let lastX = 0;
    let lastY = 0;

    const brushColor = document.getElementById("brushColor");
    const brushSize = document.getElementById("brushSize");
    const sizeValue = document.getElementById("sizeValue");

    brushSize.addEventListener('input', () => {
      sizeValue.textContent = `${brushSize.value}px`;
    });

    function getCanvasScale() {
      const rect = canvas.getBoundingClientRect();
      return {
        scaleX: canvas.width / rect.width,
        scaleY: canvas.height / rect.height
      };
    }

    function getCanvasCoordinates(e) {
      const rect = canvas.getBoundingClientRect();
      const scale = getCanvasScale();
      
      return {
        x: (e.clientX - rect.left) * scale.scaleX,
        y: (e.clientY - rect.top) * scale.scaleY
      };
    }

    canvas.addEventListener("mousedown", (e) => {
      const coords = getCanvasCoordinates(e);
      startDrawing(coords.x, coords.y);
    });

    canvas.addEventListener("mouseup", stopDrawing);
    canvas.addEventListener("mouseout", stopDrawing);
    
    canvas.addEventListener("mousemove", (e) => {
      const coords = getCanvasCoordinates(e);
      draw(coords.x, coords.y);
    });

    canvas.addEventListener("touchstart", (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const coords = getCanvasCoordinates(touch);
      startDrawing(coords.x, coords.y);
    });

    canvas.addEventListener("touchend", (e) => {
      e.preventDefault();
      stopDrawing();
    });

    canvas.addEventListener("touchmove", (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      const coords = getCanvasCoordinates(touch);
      draw(coords.x, coords.y);
    });

    function startDrawing(x, y) {
      drawing = true;
      [lastX, lastY] = [x, y];
    }

    function stopDrawing() {
      drawing = false;
    }

    function draw(x, y) {
      if (!drawing) return;
      
      ctx.strokeStyle = brushColor.value;
      ctx.lineWidth = brushSize.value;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      
      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();
      
      [lastX, lastY] = [x, y];
    }

    // æ¸…ç©ºç”»å¸ƒ
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // æ’å…¥æ¶‚é¸¦
    function insertDoodle() {
      const content = document.getElementById("diary-content");
      const dataURL = canvas.toDataURL();
      
      const img = document.createElement('img');
      img.src = dataURL;
      img.className = 'preview-img my-2 max-w-full h-auto rounded-lg shadow-sm';
      
      img.addEventListener('click', () => {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4';
        modal.innerHTML = `<img src="${img.src}" class="max-h-[90vh] max-w-[90vw] object-contain" />`;
        modal.addEventListener('click', () => modal.remove());
        document.body.appendChild(modal);
      });
      
      content.appendChild(document.createElement('br'));
      content.appendChild(img);
      content.appendChild(document.createElement('br'));
      clearCanvas();
    }

    // æ¸…ç©ºå†…å®¹
    document.getElementById('clearButton').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
        document.getElementById('diary-content').innerHTML = '';
        document.getElementById('location').value = '';
        clearCanvas();
        
        const clearButton = document.getElementById('clearButton');
        const originalText = clearButton.innerHTML;
        clearButton.innerHTML = '<i class="fa fa-check mr-2"></i>å·²æ¸…ç©º';
        
        setTimeout(() => {
          clearButton.innerHTML = originalText;
        }, 1500);
      }
    });

    // ä¿å­˜æ—¥è®°
    document.getElementById('saveButton').addEventListener('click', () => {
      const time = document.getElementById('time').value;
      const weather = document.getElementById('weather').value;
      const mood = document.getElementById('mood').value;
      const location = document.getElementById('location').value;
      const content = document.getElementById('diary-content').innerHTML;
      
      if (!time || !content.trim()) {
        alert('è¯·å¡«å†™æ—¶é—´å’Œæ—¥è®°å†…å®¹');
        return;
      }
      
      const diaryData = {
        id: Date.now(),
        time,
        weather,
        mood,
        location,
        content,
        createdAt: new Date().toISOString()
      };
      
      const savedDiaries = JSON.parse(localStorage.getItem('diaries') || '[]');
      savedDiaries.push(diaryData);
      localStorage.setItem('diaries', JSON.stringify(savedDiaries));
      
      const saveButton = document.getElementById('saveButton');
      const originalText = saveButton.innerHTML;
      saveButton.innerHTML = '<i class="fa fa-check mr-2"></i>ä¿å­˜æˆåŠŸ!';
      
      setTimeout(() => {
        saveButton.innerHTML = originalText;
      }, 2000);
      
      console.log('æ—¥è®°å·²ä¿å­˜:', diaryData);
    });
  </script>
</body>
</html>